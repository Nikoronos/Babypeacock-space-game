<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Babypeacock ‚Äî BPC Mini Space Game</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui,Segoe UI,Roboto,Arial}
  #brand{position:fixed;top:6px;left:12px;z-index:4;font-weight:900;letter-spacing:.3px;
    background:linear-gradient(90deg,#22d3ee,#34d399);-webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px rgba(34,211,238,.35),0 0 14px rgba(52,211,153,.25)}
  #score{position:fixed;top:8px;left:0;right:0;text-align:center;color:#00ffc8;font-weight:700;z-index:4}
  #power{position:fixed;top:8px;right:10px;color:#a7f3d0;font-weight:700;z-index:4}
  #lives{position:fixed;bottom:10px;left:0;right:0;text-align:center;color:#f87171;font-weight:700;z-index:4}
  #gameOver,#startOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;
    background:rgba(0,0,0,.82);color:#fff;font-size:20px;font-weight:800;z-index:6;text-align:center}
  .btn{margin-top:12px;padding:12px 22px;border:1px solid #00ffc8;background:#0b1220;color:#00ffc8;border-radius:12px;font-weight:900;letter-spacing:.3px}
  canvas{display:block;margin:44px auto 0 auto;background:#020617;
    touch-action:none;-webkit-user-select:none;user-select:none;width:min(420px,96vw);height:auto;max-height:92vh}
</style>
</head>
<body>
  <div id="brand">Babypeacock ü¶ö</div>
  <div id="score">ü¶ö Score: <span id="sc">0</span></div>
  <div id="power">üíé x <span id="px">0</span></div>
  <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>

  <div id="startOverlay" style="display:flex">
    <div style="margin-bottom:8px">üéÆ Ready?</div>
    <div style="font-size:14px;opacity:.85;margin-bottom:10px">Hold & drag to move ‚Ä¢ Auto fire while holding</div>
    <button id="startBtn" class="btn" type="button">START</button>
  </div>

  <div id="gameOver">
    <div>üíÄ GAME OVER üíÄ</div>
    <button id="restart" class="btn" type="button">Restart</button>
  </div>

  <canvas id="game" width="420" height="700"></canvas>

  <audio id="boom" preload="auto" playsinline>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2b1b0dcd8c.mp3" type="audio/mpeg">
  </audio>

<script>
/* ====== Canvas & HUD ====== */
const cv=document.getElementById("game"),ctx=cv.getContext("2d");
ctx.imageSmoothingEnabled=false;
const scEl=document.getElementById("sc"),pxEl=document.getElementById("px"),livesEl=document.getElementById("lives");
const startOverlay=document.getElementById("startOverlay"),startBtn=document.getElementById("startBtn"),
      overEl=document.getElementById("gameOver"),restartBtn=document.getElementById("restart"),
      boom=document.getElementById("boom");

/* ====== Utils ====== */
function clamp(v,min,max){return v<min?min:(v>max?max:v);}
function rectHit(a,b){return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);}
function rand(a,b){return a+Math.random()*(b-a);}
function loadImage(src){return new Promise((res,rej)=>{const i=new Image();i.crossOrigin="anonymous";i.onload=()=>res(i);i.onerror=rej;i.src=src;});}
function keyOutDark(img,TH=80){
  const off=document.createElement("canvas"); off.width=img.width; off.height=img.height;
  const g=off.getContext("2d"); g.drawImage(img,0,0);
  const d=g.getImageData(0,0,off.width,off.height), a=d.data;
  for(let p=0;p<a.length;p+=4){
    const r=a[p],g1=a[p+1],b=a[p+2],lum=0.2126*r+0.7152*g1+0.0722*b;
    if((r<TH&&g1<TH&&b<TH)||lum<TH*0.8) a[p+3]=0;
  }
  g.putImageData(d,0,0);
  return off;
}

/* ====== Asset paths ====== */
const PLAYER_SRC = "img/player/bpc_mini.png";
const ENEMY_SRC  = {
  red:  "bpc_enemy_red.png",
  green:"bpc_enemy_green.png",
  ufo_red:  "bpc_enemy_ufo_red.png",
  ufo_gray: "bpc_enemy_ufo_gray.png",
};
const PEACOCK_SRC = "yc3ku6.jpg"; // ü¶ö ku≈ü power-up

/* ====== State ====== */
let bullets=[], enemies=[], gems=[], enemyBullets=[], particles=[], mascots=[];
let score=0,powerShots=0,lives=3,started=false,gameOver=false;
let fireTimer=0,FIRE_MS=170;
const player={x:cv.width/2-33,y:cv.height-120,w:66,h:66};

/* ====== Stable starfield ====== */
const density=(cv.width<380?0.6:(cv.width<420?0.8:1));
const starsA=[], starsB=[];
for(let i=0;i<Math.round(60*density);i++) starsA.push({x:Math.random()*cv.width,y:Math.random()*cv.height});
for(let i=0;i<Math.round(35*density);i++) starsB.push({x:Math.random()*cv.width,y:Math.random()*cv.height});
const vA=0.35*density,vB=0.9*density;

/* ====== Overlays & controls ====== */
function updateLives(){livesEl.innerHTML="‚ù§Ô∏è".repeat(lives);} updateLives();
function startGame(){ if(started) return; started=true; startOverlay.style.display="none"; }
startBtn.onclick=startGame; cv.onclick=startGame;

let holding=false;
function getX(e){return (e.clientX ?? (e.touches?e.touches[0].clientX:0)) - cv.getBoundingClientRect().left;}
cv.addEventListener("pointerdown",(e)=>{ if(!started)return; holding=true; player.x=clamp(getX(e)-player.w/2,0,cv.width-player.w);});
cv.addEventListener("pointermove",(e)=>{ if(!holding)return; player.x=clamp(getX(e)-player.w/2,0,cv.width-player.w);});
cv.addEventListener("pointerup",()=>holding=false);
cv.addEventListener("pointercancel",()=>holding=false);

/* ====== Player fire ====== */
function shoot(){
  if(powerShots>0){
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:3});
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:-3});
    powerShots--; pxEl.textContent=powerShots;
  }
  bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:0});
}

/* ====== Vector fallback for enemies (if PNG missing) ====== */
function drawEnemyShip(ctx,e){
  ctx.save(); ctx.translate(e.x+e.w/2,e.y+e.h/2); const W=e.w,H=e.h;
  if(e.kind==="red"){
    ctx.fillStyle="#ef4444"; ctx.strokeStyle="#7f1d1d"; ctx.lineWidth=2;
    ctx.fillRect(-W*0.35,-H*0.3,W*0.7,H*0.6);
    ctx.fillStyle="#f87171"; ctx.fillRect(-W*0.5,-H*0.1,W*0.2,H*0.2); ctx.fillRect(W*0.3,-H*0.1,W*0.2,H*0.2);
  } else if(e.kind==="green"){
    ctx.fillStyle="#22c55e"; ctx.beginPath(); ctx.ellipse(0,H*0.05,W*0.45,H*0.28,0,0,6.283); ctx.fill();
    ctx.fillStyle="#86efac"; ctx.beginPath(); ctx.ellipse(0,-H*0.12,W*0.25,H*0.18,0,0,6.283); ctx.fill();
  } else { // UFOs
    const body = (e.kind==="ufo_red") ? "#ef4444" : "#9ca3af";
    const dome = (e.kind==="ufo_red") ? "#fda4af" : "#e5e7eb";
    ctx.fillStyle=body; ctx.beginPath(); ctx.ellipse(0,H*0.05,W*0.46,H*0.26,0,0,6.283); ctx.fill();
    ctx.fillStyle=dome; ctx.beginPath(); ctx.ellipse(0,-H*0.12,W*0.23,H*0.16,0,0,6.283); ctx.fill();
  }
  ctx.restore();
}

/* ====== SPAWN: wave takvimi (yoƒüunluk aynƒ± kalƒ±r) ====== */
let elapsed=0, enT=0, gemT=0, mascotT=0; // elapsed: saniye
const ENEMY_INTERVAL_MS = 600;           // mevcut yoƒüunluk (deƒüi≈ütirmedik)
function allowedKindsByTime(tSec){
  if (tSec < 10) return ['ufo_red','ufo_gray'];
  if (tSec < 40) return ['ufo_red','ufo_gray','green'];
  return ['ufo_red','ufo_gray','green','red'];
}
function spawnEnemy(allowedKinds){
  if(enemies.length>12) return;
  const size=rand(48,70);
  const kind=allowedKinds[Math.floor(Math.random()*allowedKinds.length)];
  const img = enemyImg[kind] || null;
  enemies.push({
    x:rand(0,cv.width-size), y:-size, w:size, h:size,
    vy:rand(1.4,3), kind, img,
    canShoot:(kind==='red'||kind==='green'),
    shootT:0, shootInt:500
  });
}
function enemyShoot(e){
  if(!e.canShoot) return; // UFO ate≈ü etmez
  const cx=e.x+e.w/2;
  if(e.kind==="red"){
    enemyBullets.push({x:cx-2,y:e.y+e.h,w:4,h:12,vy:5,color:"#ef4444"});
  }else{
    enemyBullets.push({x:cx-1,y:e.y+e.h,w:2,h:18,vy:6,color:"#22c55e"});
  }
}
function spawnGem(){const s=22;gems.push({x:rand(0,cv.width-s),y:-s,w:s,h:s,vy:1.5});}

/* ====== Mascot (ü¶ö) ====== */
let peacockImg=null;
function spawnMascot(){
  if(!peacockImg) return;
  if(mascots.length>1) return;
  const s=22; mascots.push({x:rand(0,cv.width-s),y:-s,w:s,h:s,vy:1.4});
}

/* ====== Particles / explosion ====== */
function explosion(x,y,count=14){
  const n=Math.min(count,70-particles.length);
  for(let i=0;i<n;i++){
    const ang=Math.random()*6.283, sp=1.4+Math.random()*2.8;
    particles.push({x,y,vx:Math.cos(ang)*sp,vy:Math.sin(ang)*sp,life:360+Math.random()*240,size:2+Math.random()*2.5});
  }
  try{ boom.currentTime=0; boom.play().catch(()=>{});}catch{}
}

/* ====== Loop ====== */
function endGame(){gameOver=true;overEl.style.display="flex";}

function update(dt){
  // stars scroll
  starsA.forEach(s=>{s.y+=vA; if(s.y>cv.height){s.y=0; s.x=Math.random()*cv.width;}});
  starsB.forEach(s=>{s.y+=vB; if(s.y>cv.height){s.y=0; s.x=Math.random()*cv.width;}});

  if(!started||gameOver) return;

  // zaman + wave
  elapsed += dt/1000;
  enT += dt; gemT += dt; mascotT += dt;

  // oyuncu ate≈üi
  fireTimer+=dt; if(holding && fireTimer>FIRE_MS){ shoot(); fireTimer=0; }

  // d√º≈üman doƒüur (mevcut yoƒüunluk: 600ms)
  if(enT>ENEMY_INTERVAL_MS){
    spawnEnemy(allowedKindsByTime(elapsed));
    enT=0;
  }

  // power-ups
  if(gemT>6000){ spawnGem(); gemT=0; }
  if(mascotT>12000){ spawnMascot(); mascotT=0; }

  // player bullets
  bullets.forEach(b=>{ b.y+=b.vy; b.x+=(b.ang||0)*0.45; });
  bullets=bullets.filter(b=>b.y>-20);

  // enemies
  enemies.forEach(e=>{ e.y+=e.vy; e.shootT+=dt; if(e.canShoot && e.shootT>=e.shootInt){ e.shootT=0; enemyShoot(e); } });
  // ka√ßan can g√∂t√ºrmez
  enemies=enemies.filter(e=> e.y<=cv.height+30 );

  // enemy bullets
  enemyBullets.forEach(m=>{ m.y+=m.vy; });
  enemyBullets=enemyBullets.filter(m=> m.y<cv.height+40 );

  // gems & mascots
  gems.forEach(g=>{ g.y+=g.vy; });       gems=gems.filter(g=> g.y<cv.height+40 );
  mascots.forEach(m=>{ m.y+=m.vy; });    mascots=mascots.filter(m=> m.y<cv.height+40 );

  // collisions
  for(const e of enemies){
    if(rectHit(player,e)){ explosion(player.x+player.w/2,player.y+player.h/2,22); lives--; updateLives(); if(lives<=0) endGame(); e.dead=true; }
  }
  for(const m of enemyBullets){
    if(rectHit(player,m)){ explosion(player.x+player.w/2,player.y+player.h/2,22); lives--; updateLives(); if(lives<=0) endGame(); m.dead=true; }
  }
  for(const b of bullets){
    for(const e of enemies){
      if(rectHit(b,e)){ explosion(e.x+e.w/2,e.y+e.h/2,16); b.dead=true; e.dead=true; score++; scEl.textContent=score; }
    }
  }
  for(const g of gems){
    if(rectHit(player,g)){ powerShots+=3; pxEl.textContent=powerShots; g.dead=true; }
  }
  for(const m of mascots){
    if(rectHit(player,m)){ lives=Math.min(5,lives+1); updateLives(); m.dead=true; }
  }

  enemies=enemies.filter(o=>!o.dead);
  bullets=bullets.filter(o=>!o.dead);
  enemyBullets=enemyBullets.filter(o=>!o.dead);
  gems=gems.filter(o=>!o.dead);
  mascots=mascots.filter(o=>!o.dead);

  // particles physics
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.life-=dt; if(p.life<=0){ particles.splice(i,1); continue; }
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.02;
  }
}

function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);

  // stars
  ctx.fillStyle="rgba(190,220,255,.8)"; starsA.forEach(s=>ctx.fillRect(s.x,s.y,1,1));
  ctx.fillStyle="rgba(255,255,255,.9)";  starsB.forEach(s=>ctx.fillRect(s.x,s.y,1.2,1.2));

  // player
  if (playerImg) ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
  else { ctx.fillStyle="#38bdf8"; ctx.fillRect(player.x,player.y,player.w,player.h); }

  // player bullets
  ctx.fillStyle="#00ffc8"; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

  // enemies
  enemies.forEach(e=>{
    if(e.img) ctx.drawImage(e.img,e.x,e.y,e.w,e.h);
    else drawEnemyShip(ctx,e);
  });

  // enemy bullets
  enemyBullets.forEach(m=>{ ctx.fillStyle=m.color; ctx.fillRect(m.x,m.y,m.w,m.h); });

  // gift gem (light blue)
  ctx.fillStyle="#38bdf8"; ctx.strokeStyle="#0e7490"; ctx.lineWidth=1.6;
  gems.forEach(g=>{ ctx.fillRect(g.x+g.w*0.2,g.y+g.h*0.2,g.w*0.6,g.h*0.6); ctx.strokeRect(g.x+g.w*0.2,g.y+g.h*0.2,g.w*0.6,g.h*0.6); });

  // mascot ü¶ö
  if (peacockImg) mascots.forEach(m=>ctx.drawImage(peacockImg,m.x,m.y,m.w,m.h));
  else { ctx.fillStyle="#60a5fa"; mascots.forEach(m=>ctx.fillRect(m.x,m.y,m.w,m.h)); }

  // particles
  ctx.fillStyle="rgba(255,200,80,.95)";
  particles.forEach(p=>{ const a=Math.max(0,p.life/400); ctx.globalAlpha=a; ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,6.283); ctx.fill(); ctx.globalAlpha=1; });
}

function loop(t){ const dt=Math.min(t-(window._lt||t),32); window._lt=t; update(dt); draw(); requestAnimationFrame(loop); }
requestAnimationFrame(loop);

restartBtn.onclick=()=>{ score=0; powerShots=0; lives=3; updateLives();
  bullets=[]; enemies=[]; enemyBullets=[]; gems=[]; particles=[]; mascots=[];
  gameOver=false; started=false; overEl.style.display="none"; startOverlay.style.display="flex";
};

/* ====== PRELOAD (assets) ====== */
let playerImg=null, enemyImg={red:null, green:null, ufo_red:null, ufo_gray:null};
(async function(){
  try{ const p=await loadImage(PLAYER_SRC); playerImg=keyOutDark(p,80);}catch{}
  for(const k of Object.keys(ENEMY_SRC)){
    try{ const im=await loadImage(ENEMY_SRC[k]); enemyImg[k]=keyOutDark(im,80);}catch{}
  }
  try{ const bird=await loadImage(PEACOCK_SRC); peacockImg=keyOutDark(bird,70);}catch{}
})();
</script>
</body>
</html>
