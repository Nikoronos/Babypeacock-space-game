<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>BPC Mini Uzay Oyunu ü¶ö</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui}
  #score{position:fixed;top:10px;left:0;right:0;text-align:center;color:#00ffc8;font-weight:700}
  canvas{display:block;margin:50px auto 0 auto;background:linear-gradient(#020617,#0b1220)}
  #start{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
         background:rgba(0,0,0,.8);color:#fff;font-weight:700;letter-spacing:.5px}
  #start .box{padding:18px 22px;border:1px solid #2dd4bf;border-radius:12px;text-align:center}
  #hint{font-size:14px;opacity:.8;margin-top:6px}
</style>
</head>
<body>
  <div id="score">ü¶ö Skor: <span id="sc">0</span></div>
  <div id="start"><div class="box">
    Dokun ve Ba≈ülat<br><div id="hint">S√ºr√ºkle: hareket ‚Ä¢ Dokun: ate≈ü</div>
  </div></div>
  <canvas id="game" width="480" height="720"></canvas>

  <!-- Sesler (ilk dokunu≈ütan sonra √ßalƒ±≈üacak) -->
  <audio id="shoot" preload="auto" playsinline>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_3b4b5f10a0.mp3" type="audio/mpeg">
  </audio>
  <audio id="hit" preload="auto" playsinline>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2b1b0dcd8c.mp3" type="audio/mpeg">
  </audio>

<script>
const cv = document.getElementById('game'), ctx=cv.getContext('2d');
const scEl = document.getElementById('sc');
const startEl = document.getElementById('start');
const shootS = document.getElementById('shoot');
const hitS = document.getElementById('hit');

// G√∂rseller (senin repo yapƒ±na g√∂re)
const playerImg = new Image(); playerImg.src = "img/player/bpc_mini.png";
const enemySrcs = [
  "bpc_enemy_green.png",
  "bpc_enemy_red.png",
  "bpc_enemy_ufo_gray.png",
  "bpc_enemy_ufo_red.png"
];
const enemyImgs = enemySrcs.map(s=>{ const i=new Image(); i.src=s; return i; });

// Ekrana g√∂re tuval y√ºksekliƒüini ayarla
function fitCanvas(){
  const h = Math.min(820, window.innerHeight-20);
  cv.height = Math.max(620, h);
}
fitCanvas(); addEventListener('resize', fitCanvas);

// Oyun durumu
const bullets=[], enemies=[];
let score=0, keys={}, started=false, lastSpawn=0, shootCd=0;
const player = {x: cv.width/2-28, y: cv.height-110, w:56, h:56, speed:5};

document.addEventListener('keydown', e=>{keys[e.key.toLowerCase()]=true;});
document.addEventListener('keyup',   e=>{keys[e.key.toLowerCase()]=false;});

// Dokunmatik: s√ºr√ºkle ‚Üí hareket, dokun ‚Üí ate≈ü
let touchX=null;
cv.addEventListener('pointerdown', e=>{
  if(!started) begin(); 
  touchX = e.offsetX; shoot();
});
cv.addEventListener('pointermove', e=>{
  if(touchX!=null){ player.x = e.offsetX - player.w/2; clampPlayer(); }
});
cv.addEventListener('pointerup', ()=>{ touchX=null; });

function clampPlayer(){ player.x = Math.max(0, Math.min(cv.width-player.w, player.x)); }

function shoot(){
  bullets.push({x:player.x+player.w/2-2, y:player.y-12, w:4,h:12, vy:-9});
  try{ shootS.currentTime=0; shootS.play(); }catch(_){}
}
function spawnEnemy(){
  const img = enemyImgs[Math.floor(Math.random()*enemyImgs.length)];
  const size = 44 + Math.random()*28;
  enemies.push({x:Math.random()*(cv.width-size), y:-size, w:size, h:size, vy:1.3+Math.random()*2.2, img});
}
function rectHit(a,b){ return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h); }

function update(dt){
  // klavye hareket
  if(keys['arrowleft']||keys['a']) { player.x-=player.speed; clampPlayer(); }
  if(keys['arrowright']||keys['d']){ player.x+=player.speed; clampPlayer(); }
  // ate≈ü
  if((keys[' ']||keys['spacebar']) && shootCd<=0){ shoot(); shootCd=14; }
  shootCd--;

  // mermiler
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y+=b.vy; if(b.y<-20) bullets.splice(i,1);
  }
  // d√º≈ümanlar
  lastSpawn+=dt; if(lastSpawn>800){ spawnEnemy(); lastSpawn=0; }
  enemies.forEach(e=>{ e.y+=e.vy; });
  for(let i=enemies.length-1;i>=0;i--) if(enemies[i].y>cv.height+50) enemies.splice(i,1);

  // √ßarpƒ±≈üma
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(rectHit({x:b.x,y:b.y,w:b.w,h:b.h},{x:e.x,y:e.y,w:e.w,h:e.h})){
        enemies.splice(i,1); bullets.splice(j,1);
        score++; scEl.textContent=score;
        try{ hitS.currentTime=0; hitS.play(); }catch(_){}
        break;
      }
    }
  }
}

function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);
  // player
  ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
  // bullets
  ctx.fillStyle="#00ffc8"; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
  // enemies
  enemies.forEach(e=>ctx.drawImage(e.img,e.x,e.y,e.w,e.h));
}

let last=performance.now();
function loop(t){
  const dt = t-last; last=t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

function begin(){
  started=true;
  startEl.style.display='none';
  // mobil ses izni: sessiz √ßalƒ±p izin al
  shootS.muted=true; shootS.play().then(()=>{ shootS.pause(); shootS.muted=false; });
  hitS.muted=true; hitS.play().then(()=>{ hitS.pause(); hitS.muted=false; });
}

requestAnimationFrame(loop);
</script>
</body>
</html>
