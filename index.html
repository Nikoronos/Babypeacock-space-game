<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Babypeacock — BPC Mini Uzay Oyunu</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui}
  /* Brand */
  #brand{
    position:fixed;top:6px;left:12px;z-index:4;
    font-weight:900;letter-spacing:.3px;
    background:linear-gradient(90deg,#22d3ee,#34d399);
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px rgba(34,211,238,.35), 0 0 14px rgba(52,211,153,.25);
    user-select:none
  }
  #brand small{opacity:.9;font-weight:700}
  /* HUD */
  #score{position:fixed;top:8px;left:0;right:0;text-align:center;color:#00ffc8;font-weight:700;z-index:4}
  #power{position:fixed;top:8px;right:10px;color:#a7f3d0;font-weight:700;z-index:4}
  #lives{position:fixed;bottom:10px;left:0;right:0;text-align:center;color:#f87171;font-weight:700;z-index:4}
  #gameOver, #startOverlay{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;
    background:rgba(0,0,0,0.82);color:#fff;font-size:20px;font-weight:800;z-index:6
  }
  .btn{
    margin-top:12px;padding:12px 22px;border:1px solid #00ffc8;background:#0b1220;
    color:#00ffc8;border-radius:12px;font-weight:900;letter-spacing:.3px
  }
  /* Canvas: iç çözünürlük sabit, görünüş esnek */
  canvas{
    display:block;margin:44px auto 0 auto;
    background:linear-gradient(#020617,#0b1220);
    touch-action:none;-webkit-user-select:none;user-select:none;
    width:min(420px,96vw); height:auto; max-height:92vh;
  }
</style>
</head>
<body>
  <div id="brand">Babypeacock 🦚<br><small>arcade</small></div>
  <div id="score">🦚 Skor: <span id="sc">0</span></div>
  <div id="power">💎 x <span id="px">0</span></div>
  <div id="lives">❤️❤️❤️</div>

  <!-- Başlangıç ekranı -->
  <div id="startOverlay">
    <div style="margin-bottom:8px">🎮 Oyuna Hazır mısın?</div>
    <div style="font-size:14px;opacity:.85;margin-bottom:10px">Basılı tutup sürükle • Basılıyken otomatik ateş</div>
    <button id="startBtn" class="btn">BAŞLA</button>
    <div style="font-size:12px;opacity:.7;margin-top:8px">ya da ekrana dokun</div>
  </div>

  <!-- Oyun bitti -->
  <div id="gameOver">
    <div>💀 Oyun Bitti 💀</div>
    <button id="restart" class="btn">Yeniden Başlat</button>
  </div>

  <!-- İç çözünürlük sabit: 420x700 -->
  <canvas id="game" width="420" height="700"></canvas>

  <!-- 🔊 Patlama sesi -->
  <audio id="boom" preload="auto" playsinline>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2b1b0dcd8c.mp3" type="audio/mpeg">
  </audio>

<script>
/* ====== Canvas & HUD ====== */
const cv=document.getElementById("game"),ctx=cv.getContext("2d");
const scEl=document.getElementById("sc"),pxEl=document.getElementById("px"),
      livesEl=document.getElementById("lives"),
      overEl=document.getElementById("gameOver"),
      restartBtn=document.getElementById("restart"),
      startOverlay=document.getElementById("startOverlay"),
      startBtn=document.getElementById("startBtn"),
      boom=document.getElementById("boom");

/* ====== Görsel temizleme ====== */
function loadImage(src){return new Promise((res,rej)=>{const i=new Image();i.onload=()=>res(i);i.onerror=rej;i.src=src;});}
function keyOutDark(img,TH=80){
  const w=img.width,h=img.height,off=document.createElement("canvas");
  off.width=w;off.height=h;const ox=off.getContext("2d");ox.drawImage(img,0,0);
  const d=ox.getImageData(0,0,w,h),a=d.data;
  for(let p=0;p<a.length;p+=4){
    const r=a[p],g=a[p+1],b=a[p+2],lum=0.2126*r+0.7152*g+0.0722*b;
    if((r<TH&&g<TH&&b<TH)||lum<TH*0.8)a[p+3]=0; else if(lum<TH*1.1)a[p+3]=Math.max(0,a[p+3]-120);
  }
  ox.putImageData(d,0,0); return off;
}

/* ====== Assetler ====== */
const PLAYER_SRC="img/player/bpc_mini.png";
const ENEMY_SRCS=["bpc_enemy_green.png","bpc_enemy_red.png","bpc_enemy_ufo_gray.png","bpc_enemy_ufo_red.png"];

/* ====== Oyun durumu ====== */
const bullets=[], enemies=[], gems=[], particles=[];
let score=0,powerShots=0,holding=false,pointerId=null,fireTimer=0,FIRE_MS=160;
let lives=3,gameOver=false, started=false;
const player={x:cv.width/2-33,y:cv.height-120,w:66,h:66}; // 1 tık büyük

/* ====== Arkaplan: yıldızlar + küçük gezegenler ====== */
const stars=[], planets=[];
for(let i=0;i<120;i++){
  stars.push({x:Math.random()*cv.width, y:Math.random()*cv.height, s:Math.random()*1.6+0.4, v:0.3+Math.random()*0.9, tw:Math.random()*2*Math.PI});
}
function spawnPlanet(){
  const r=8+Math.random()*12;
  planets.push({
    x:Math.random()*(cv.width-r*2)+r, y:-r, r,
    v:0.3+Math.random()*0.5,
    hue: 180+Math.random()*120
  });
}
let planetT=0;

/* ====== Can, skor ====== */
function updateLivesDisplay(){ livesEl.innerHTML="❤️".repeat(lives); }

/* ====== Başlatma (buton + her dokunuş) & ses izni ====== */
let audioArmed=false;
function armAudio(){
  if(audioArmed) return;
  try{ boom.muted=true; boom.play().then(()=>{boom.pause(); boom.muted=false; boom.currentTime=0; audioArmed=true;}); }catch{}
}
function startGame(){
  if(started) return;
  armAudio();
  started=true;
  startOverlay.style.display='none';
}
startOverlay.style.display="flex";
startBtn.addEventListener('click', startGame);
startOverlay.addEventListener('click', startGame); // overlay'e dokunmak da başlatır

/* ====== Kontrol: basılı tut & sürükle ====== */
function canvasXFromEvent(e){
  const r=cv.getBoundingClientRect();
  const cx=(e.clientX!==undefined)?e.clientX:(e.touches?e.touches[0].clientX:0);
  return cx-r.left;
}
function startPointer(e){
  if(!started) return;
  if(holding) return;
  holding=true;
  if(e.pointerId!==undefined){ pointerId=e.pointerId; cv.setPointerCapture(pointerId); }
  movePointer(e); e.preventDefault();
}
function movePointer(e){
  if(!started || !holding) return;
  if(e.pointerId!==undefined && pointerId!==null && e.pointerId!==pointerId) return;
  const x=canvasXFromEvent(e)-player.w/2;
  player.x=Math.max(0,Math.min(cv.width-player.w,x));
  e.preventDefault();
}
function endPointer(e){
  if(!holding) return;
  if(e.pointerId!==undefined && pointerId!==null && e.pointerId!==pointerId) return;
  holding=false;
  if(pointerId!==null){ try{ cv.releasePointerCapture(pointerId); }catch{} pointerId=null; }
  e.preventDefault();
}
cv.addEventListener("pointerdown",startPointer,{passive:false});
cv.addEventListener("pointermove",movePointer,{passive:false});
cv.addEventListener("pointerup",endPointer,{passive:false});
cv.addEventListener("pointercancel",endPointer,{passive:false});
cv.addEventListener("touchstart",startPointer,{passive:false});
cv.addEventListener("touchmove",movePointer,{passive:false});
cv.addEventListener("touchend",endPointer,{passive:false});
cv.addEventListener("touchcancel",endPointer,{passive:false});

/* ====== Ateş & mermi ====== */
function addBullet(x,vy,ang){ bullets.push({x,y:player.y-12,w:4,h:12,vy,ang}); }
function shoot(){
  if(powerShots>0){
    addBullet(player.x+player.w/2-2,-10,0);
    addBullet(player.x+player.w/2-2,-10,-3);
    addBullet(player.x+player.w/2-2,-10, 3);
    powerShots--; pxEl.textContent=powerShots;
  } else {
    addBullet(player.x+player.w/2-2,-10,0);
  }
}

/* ====== Enemy, power-up, patlama parçacıkları ====== */
function spawnEnemy(){
  const img=enemiesImgs[Math.floor(Math.random()*enemiesImgs.length)];
  const size=52+Math.random()*30;
  enemies.push({x:Math.random()*(cv.width-size),y:-size,w:size,h:size,vy:1.6+Math.random()*2.2,img});
}
function spawnGem(){ const s=24; gems.push({x:Math.random()*(cv.width-s),y:-s,w:s,h:s,vy:1.8}); }
function rectHit(a,b){ return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h); }

function spawnExplosion(x,y,count=16){
  for(let i=0;i<count;i++){
    const ang=Math.random()*Math.PI*2;
    const sp=1.5+Math.random()*3.5;
    particles.push({
      x,y, vx:Math.cos(ang)*sp, vy:Math.sin(ang)*sp,
      life:400+Math.random()*250, size:2+Math.random()*3, hue: 40+Math.random()*20
    });
  }
  try{ boom.currentTime=0; boom.play(); }catch{}
}

/* ====== Update & Draw ====== */
let spawnT=0, gemT=0, last=performance.now();
function update(dt){
  // Arkaplan her zaman akar
  stars.forEach(s=>{ s.y+=s.v; if(s.y>cv.height) s.y=0, s.x=Math.random()*cv.width; s.tw+=0.04; });
  planetT+=dt; if(planetT>5000){ spawnPlanet(); planetT=0; }
  planets.forEach(p=>{ p.y+=p.v; });
  for(let i=planets.length-1;i>=0;i--) if(planets[i].y>cv.height+p[i]?.r) planets.splice(i,1);

  if(gameOver || !started) return;

  // basılıyken sürekli ateş
  fireTimer+=dt; if(holding && fireTimer>FIRE_MS){ shoot(); fireTimer=0; }

  // mermiler
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y+=b.vy; b.x+=(b.ang||0)*0.6; if(b.y<-20) bullets.splice(i,1);
  }

  // düşmanlar
  spawnT+=dt; if(spawnT>700){ spawnEnemy(); spawnT=0; }
  enemies.forEach(e=>{ e.y+=e.vy; });

  // kaçan düşman → can eksilt
  for(let i=enemies.length-1;i>=0;i--){
    if(enemies[i].y>cv.height+10){
      enemies.splice(i,1);
      lives--; updateLivesDisplay();
      if(lives<=0){ endGame(); return; }
    }
  }

  // power-up akışı
  gemT+=dt; if(gemT>5200){ spawnGem(); gemT=0; }
  gems.forEach(g=>{ g.y+=g.vy; });
  for(let i=gems.length-1;i>=0;i--) if(gems[i].y>cv.height+40) gems.splice(i,1);

  // kurşun - düşman
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(rectHit(b,e)){
        spawnExplosion(e.x+e.w/2, e.y+e.h/2, 18);
        enemies.splice(i,1); bullets.splice(j,1);
        score++; scEl.textContent=score;
        break;
      }
    }
  }

  // oyuncu - gem
  for(let i=gems.length-1;i>=0;i--){
    const g=gems[i];
    if(rectHit(player,g)){ gems.splice(i,1); powerShots+=3; pxEl.textContent=powerShots; }
  }

  // oyuncu - düşman
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    if(rectHit(player,e)){
      spawnExplosion(player.x+player.w/2, player.y+player.h/2, 24);
      enemies.splice(i,1);
      lives--; updateLivesDisplay();
      if(lives<=0){ endGame(); }
      break;
    }
  }

  // parçacıklar
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.life-=dt; if(p.life<=0){ particles.splice(i,1); continue; }
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.02;
  }
}

function draw(){
  // arkaplan (yıldız+gezegen)
  ctx.clearRect(0,0,cv.width,cv.height);
  // yıldızlar
  stars.forEach(s=>{
    const a = 0.6 + 0.4*Math.sin(s.tw);
    ctx.fillStyle = `rgba(180,220,255,${a})`;
    ctx.fillRect(s.x, s.y, s.s, s.s);
  });
  // gezegenler
  planets.forEach(p=>{
    const g=ctx.createRadialGradient(p.x,p.y,1,p.x,p.y,p.r);
    g.addColorStop(0,`hsla(${p.hue},90%,70%,.95)`);
    g.addColorStop(1,`hsla(${p.hue},70%,35%,.85)`);
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
  });

  // oyuncu
  ctx.drawImage(playerImgKeyed, player.x, player.y, player.w, player.h);
  // mermiler
  ctx.fillStyle="#00ffc8"; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
  // düşmanlar
  enemies.forEach(e=>ctx.drawImage(e.img,e.x,e.y,e.w,e.h));
  // power-up taş
  gems.forEach(g=>{
    const {x,y,w,h}=g; ctx.save(); ctx.translate(x+w/2,y+h/2); ctx.scale(w/30,h/30);
    ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(8,-2); ctx.lineTo(5,10); ctx.lineTo(-5,10); ctx.lineTo(-8,-2); ctx.closePath();
    ctx.fillStyle="#22c55e"; ctx.fill(); ctx.strokeStyle="#065f46"; ctx.lineWidth=1.8; ctx.stroke();
    ctx.beginPath(); ctx.moveTo(-3,-3); ctx.lineTo(0,-6); ctx.lineTo(3,-3); ctx.lineTo(0,0); ctx.closePath();
    ctx.fillStyle="#86efac"; ctx.fill(); ctx.restore();
  });
  // patlama parçacıkları
  particles.forEach(p=>{
    const alpha=Math.max(0, p.life/500);
    ctx.fillStyle=`hsla(${p.hue}, 95%, 60%, ${alpha})`;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
  });
}

/* ====== Oyun sonu & restart ====== */
function endGame(){ gameOver=true; overEl.style.display="flex"; }
restartBtn.onclick=()=>{
  score=0; powerShots=0; lives=3; gameOver=false;
  bullets.length=enemies.length=gems.length=particles.length=0;
  scEl.textContent=score; pxEl.textContent=powerShots; updateLivesDisplay();
  overEl.style.display="none";
  started=false;
  startOverlay.style.display='flex';
};

/* ====== Döngü ====== */
function loop(t){ const dt=t-(window._lt||t); window._lt=t; update(dt); draw(); requestAnimationFrame(loop); }
requestAnimationFrame(loop);

/* ====== Preload ====== */
let playerImgKeyed, enemiesImgs=[];
(async function(){
  const p=await loadImage(PLAYER_SRC); playerImgKeyed=keyOutDark(p,80);
  enemiesImgs=[]; for(const s of ENEMY_SRCS){ const i=await loadImage(s); enemiesImgs.push(keyOutDark(i,80)); }
})();
updateLivesDisplay();
</script>
</body>
</html>
