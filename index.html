<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Babypeacock ‚Äî BPC Mini Space Game</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui,Segoe UI,Roboto,Arial}
  #brand{position:fixed;top:6px;left:12px;z-index:4;font-weight:900;letter-spacing:.3px;
    background:linear-gradient(90deg,#22d3ee,#34d399);-webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px rgba(34,211,238,.35),0 0 14px rgba(52,211,153,.25)}
  #score{position:fixed;top:8px;left:0;right:0;text-align:center;color:#00ffc8;font-weight:700;z-index:4}
  #power{position:fixed;top:8px;right:10px;color:#a7f3d0;font-weight:700;z-index:4}
  #lives{position:fixed;bottom:10px;left:0;right:0;text-align:center;color:#f87171;font-weight:700;z-index:4}
  #gameOver,#startOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;
    background:rgba(0,0,0,.82);color:#fff;font-size:20px;font-weight:800;z-index:6;text-align:center}
  .btn{margin-top:12px;padding:12px 22px;border:1px solid #00ffc8;background:#0b1220;color:#00ffc8;border-radius:12px;font-weight:900;letter-spacing:.3px}
  canvas{display:block;margin:44px auto 0 auto;background:#020617;
    touch-action:none;-webkit-user-select:none;user-select:none;width:min(420px,96vw);height:auto;max-height:92vh}
</style>
</head>
<body>
  <div id="brand">Babypeacock ü¶ö</div>
  <div id="score">ü¶ö Score: <span id="sc">0</span></div>
  <div id="power">üíé x <span id="px">0</span></div>
  <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>

  <div id="startOverlay" style="display:flex">
    <div style="margin-bottom:8px">üéÆ Ready?</div>
    <div style="font-size:14px;opacity:.85;margin-bottom:10px">Hold & drag to move</div>
    <button id="startBtn" class="btn" type="button">START</button>
  </div>

  <div id="gameOver">
    <div>üíÄ GAME OVER üíÄ</div>
    <button id="restart" class="btn" type="button">Restart</button>
  </div>

  <canvas id="game" width="420" height="700"></canvas>

<script>
/* ====== Canvas & HUD ====== */
const cv=document.getElementById("game"),ctx=cv.getContext("2d");
ctx.imageSmoothingEnabled=false;
const scEl=document.getElementById("sc"),pxEl=document.getElementById("px"),livesEl=document.getElementById("lives");
const startOverlay=document.getElementById("startOverlay"),startBtn=document.getElementById("startBtn"),overEl=document.getElementById("gameOver"),restartBtn=document.getElementById("restart");

/* ====== Utils ====== */
function clamp(v,min,max){return v<min?min:(v>max?max:v);}
function rectHit(a,b){return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);}
function rand(a,b){return a+Math.random()*(b-a);}
function loadImage(src){return new Promise((res,rej)=>{const i=new Image();i.crossOrigin="anonymous";i.onload=()=>res(i);i.onerror=rej;i.src=src;});}
function keyOutDark(img,TH=80){
  const off=document.createElement("canvas"); off.width=img.width; off.height=img.height;
  const g=off.getContext("2d"); g.drawImage(img,0,0);
  const d=g.getImageData(0,0,off.width,off.height), a=d.data;
  for(let p=0;p<a.length;p+=4){
    const r=a[p],g1=a[p+1],b=a[p+2],lum=0.2126*r+0.7152*g1+0.0722*b;
    if((r<TH&&g1<TH&&b<TH)||lum<TH*0.8) a[p+3]=0;
  }
  g.putImageData(d,0,0);
  return off;
}

/* ====== Asset paths (SENƒ∞N REPO YAPINA G√ñRE) ====== */
const PLAYER_SRC = "img/player/bpc_mini.png";      // oyuncu
const ENEMY_SRC  = {                                // d√º≈ümanlar (repo k√∂k√º)
  red:   "bpc_enemy_red.png",
  green: "bpc_enemy_green.png"
};

/* ====== State ====== */
let bullets=[], enemies=[], gems=[], enemyBullets=[];
let score=0,powerShots=0,lives=3,started=false,gameOver=false;
let fireTimer=0,FIRE_MS=170;
const player={x:cv.width/2-33,y:cv.height-120,w:66,h:66};

/* ====== Background stars (stable scroll) ====== */
const density=(cv.width<380?0.6:(cv.width<420?0.8:1));
const starsA=[], starsB=[];
for(let i=0;i<Math.round(60*density);i++) starsA.push({x:Math.random()*cv.width,y:Math.random()*cv.height});
for(let i=0;i<Math.round(35*density);i++) starsB.push({x:Math.random()*cv.width,y:Math.random()*cv.height});
const vA=0.35*density,vB=0.9*density;

/* ====== Start & Controls ====== */
function updateLives(){livesEl.innerHTML="‚ù§Ô∏è".repeat(lives);} updateLives();
function startGame(){ if(started) return; started=true; startOverlay.style.display="none"; }
startBtn.onclick=startGame; cv.onclick=startGame;

let holding=false;
function getX(e){return (e.clientX ?? (e.touches?e.touches[0].clientX:0)) - cv.getBoundingClientRect().left;}
cv.addEventListener("pointerdown",(e)=>{ if(!started) return; holding=true; player.x=clamp(getX(e)-player.w/2,0,cv.width-player.w);});
cv.addEventListener("pointermove",(e)=>{ if(!holding) return; player.x=clamp(getX(e)-player.w/2,0,cv.width-player.w);});
cv.addEventListener("pointerup",()=>holding=false);
cv.addEventListener("pointercancel",()=>holding=false);

/* ====== Player Fire ====== */
function shoot(){
  if(powerShots>0){
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:3});
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:-3});
    powerShots--; pxEl.textContent=powerShots;
  }
  bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:0});
}

/* ====== Vector fallback for enemies ====== */
function drawEnemyShip(ctx,e){
 ctx.save(); ctx.translate(e.x+e.w/2,e.y+e.h/2); const W=e.w,H=e.h;
 if(e.kind==="red"){
   ctx.fillStyle="#ef4444"; ctx.strokeStyle="#7f1d1d"; ctx.lineWidth=2;
   ctx.fillRect(-W*0.35,-H*0.3,W*0.7,H*0.6);
   ctx.fillStyle="#f87171"; ctx.fillRect(-W*0.5,-H*0.1,W*0.2,H*0.2); ctx.fillRect(W*0.3,-H*0.1,W*0.2,H*0.2);
   ctx.fillStyle="#b91c1c"; ctx.fillRect(-3,H*0.25,6,H*0.4);
 } else {
   ctx.fillStyle="#22c55e";
   ctx.beginPath(); ctx.ellipse(0,H*0.05,W*0.45,H*0.28,0,0,6.283); ctx.fill();
   ctx.fillStyle="#86efac"; ctx.beginPath(); ctx.ellipse(0,-H*0.12,W*0.25,H*0.18,0,0,6.283); ctx.fill();
   ctx.fillStyle="#16a34a"; ctx.fillRect(-2,H*0.2,4,H*0.35);
 }
 ctx.restore();
}

/* ====== Spawns ====== */
function spawnEnemy(){
  if(enemies.length>12) return;
  const size=rand(48,70);
  const kind=Math.random()<0.5?"red":"green";
  const img = enemyImg[kind] || null;   // varsa PNG, yoksa √ßizim
  enemies.push({x:rand(0,cv.width-size),y:-size,w:size,h:size,vy:rand(1.4,3),kind,img,shootT:0,shootInt:500});
}
function enemyShoot(e){
  const cx=e.x+e.w/2;
  if(e.kind==="red") enemyBullets.push({x:cx-2,y:e.y+e.h,w:4,h:12,vy:5,color:"#ef4444"});
  else               enemyBullets.push({x:cx-1,y:e.y+e.h,w:2,h:18,vy:6,color:"#22c55e"});
}
function spawnGem(){const s=22;gems.push({x:rand(0,cv.width-s),y:-s,w:s,h:s,vy:1.5});}

/* ====== Loop ====== */
function endGame(){gameOver=true;overEl.style.display="flex";}

let enT=0,gemT=0;
function update(dt){
  starsA.forEach(s=>{s.y+=vA; if(s.y>cv.height){s.y=0; s.x=Math.random()*cv.width;}});
  starsB.forEach(s=>{s.y+=vB; if(s.y>cv.height){s.y=0; s.x=Math.random()*cv.width;}});

  if(!started||gameOver) return;

  fireTimer+=dt; if(holding && fireTimer>FIRE_MS){ shoot(); fireTimer=0; }

  enT+=dt; if(enT>600){ spawnEnemy(); enT=0; }
  gemT+=dt; if(gemT>6000){ spawnGem(); gemT=0; }

  bullets.forEach(b=>{ b.y+=b.vy; b.x+=(b.ang||0)*0.45; });
  bullets=bullets.filter(b=>b.y>-20);

  enemies.forEach(e=>{ e.y+=e.vy; e.shootT+=dt; if(e.shootT>=e.shootInt){ e.shootT=0; enemyShoot(e);} });
  enemies=enemies.filter(e=>{ if(e.y>cv.height){ lives--; updateLives(); if(lives<=0) endGame(); return false;} return true; });

  enemyBullets.forEach(m=>{ m.y+=m.vy; });
  enemyBullets=enemyBullets.filter(m=>m.y<cv.height+40);

  gems.forEach(g=>{ g.y+=g.vy; });
  gems=gems.filter(g=>g.y<cv.height+40);

  for(const e of enemies) if(rectHit(player,e)){ lives--; updateLives(); if(lives<=0) endGame(); e.dead=true; }
  for(const m of enemyBullets) if(rectHit(player,m)){ lives--; updateLives(); if(lives<=0) endGame(); m.dead=true; }
  for(const b of bullets) for(const e of enemies) if(rectHit(b,e)){ b.dead=true; e.dead=true; score++; scEl.textContent=score; }
  for(const g of gems) if(rectHit(player,g)){ powerShots+=3; pxEl.textContent=powerShots; g.dead=true; }

  enemies=enemies.filter(o=>!o.dead);
  bullets=bullets.filter(o=>!o.dead);
  enemyBullets=enemyBullets.filter(o=>!o.dead);
  gems=gems.filter(o=>!o.dead);
}

function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);

  ctx.fillStyle="rgba(190,220,255,.8)"; starsA.forEach(s=>ctx.fillRect(s.x,s.y,1,1));
  ctx.fillStyle="rgba(255,255,255,.9)";  starsB.forEach(s=>ctx.fillRect(s.x,s.y,1.2,1.2));

  // PLAYER: png varsa onu √ßiz, yoksa mavi kutu
  if (playerImg) ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
  else { ctx.fillStyle="#38bdf8"; ctx.fillRect(player.x,player.y,player.w,player.h); }

  ctx.fillStyle="#00ffc8"; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

  // ENEMIES: png varsa onu √ßiz, yoksa fallback vekt√∂r
  enemies.forEach(e=>{
    if(e.img) ctx.drawImage(e.img,e.x,e.y,e.w,e.h);
    else drawEnemyShip(ctx,e);
  });

  enemyBullets.forEach(m=>{ ctx.fillStyle=m.color; ctx.fillRect(m.x,m.y,m.w,m.h); });

  ctx.fillStyle="#38bdf8"; ctx.strokeStyle="#0e7490"; ctx.lineWidth=1.6;
  gems.forEach(g=>{ ctx.fillRect(g.x+g.w*0.2,g.y+g.h*0.2,g.w*0.6,g.h*0.6); ctx.strokeRect(g.x+g.w*0.2,g.y+g.h*0.2,g.w*0.6,g.h*0.6); });
}

function loop(t){ const dt=Math.min(t-(window._lt||t),32); window._lt=t; update(dt); draw(); requestAnimationFrame(loop); }
requestAnimationFrame(loop);

restartBtn.onclick=()=>{ score=0; powerShots=0; lives=3; updateLives(); bullets=[]; enemies=[]; enemyBullets=[]; gems=[]; gameOver=false; started=false; overEl.style.display="none"; startOverlay.style.display="flex"; };

/* ====== PRELOAD (PNG'leri SENƒ∞N REPO‚ÄôDAN Y√úKLE) ====== */
let playerImg=null, enemyImg={red:null, green:null};
(async function(){
  try{ const p=await loadImage(PLAYER_SRC); playerImg=keyOutDark(p,80);}catch{}
  try{ const r=await loadImage(ENEMY_SRC.red);   enemyImg.red  =keyOutDark(r,80);}catch{}
  try{ const g=await loadImage(ENEMY_SRC.green); enemyImg.green=keyOutDark(g,80);}catch{}
})();
</script>
</body>
</html>
