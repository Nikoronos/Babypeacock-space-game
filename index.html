<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>BPC Mini Uzay Oyunu ðŸ¦š</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui}
  #score{position:fixed;top:10px;left:0;right:0;text-align:center;color:#00ffc8;font-weight:700}
  #power{position:fixed;top:10px;right:10px;color:#a7f3d0;font-weight:700}
  canvas{display:block;margin:50px auto 0 auto;background:linear-gradient(#020617,#0b1220)}
</style>
</head>
<body>
  <div id="score">ðŸ¦š Skor: <span id="sc">0</span></div>
  <div id="power">ðŸ’Ž x <span id="px">0</span></div>
  <canvas id="game" width="480" height="720"></canvas>

<script>
/* ========== KURULUM ========== */
const cv = document.getElementById('game'), ctx = cv.getContext('2d');
const scEl = document.getElementById('sc'), pxEl = document.getElementById('px');

function fitCanvas(){ const h=Math.min(820, innerHeight-20); cv.height=Math.max(620,h); }
fitCanvas(); addEventListener('resize', fitCanvas);

/* ========== SÄ°YAH ARKA PLAN TEMÄ°ZLEME ========== */
function loadImage(src){ return new Promise((res,rej)=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=src; }); }
function keyOutDark(img, TH=80){
  const w=img.width, h=img.height;
  const off=document.createElement('canvas'); off.width=w; off.height=h;
  const ox=off.getContext('2d'); ox.drawImage(img,0,0);
  const d=ox.getImageData(0,0,w,h), a=d.data;
  for(let p=0;p<a.length;p+=4){
    const r=a[p], g=a[p+1], b=a[p+2];
    const lum=0.2126*r+0.7152*g+0.0722*b;
    if((r<TH&&g<TH&&b<TH)||lum<TH*0.8) a[p+3]=0;           // tam ÅŸeffaf
    else if(lum<TH*1.1) a[p+3]=Math.max(0,a[p+3]-120);     // kenarlarda yumuÅŸak geÃ§iÅŸ
  }
  ox.putImageData(d,0,0);
  return off;
}

/* ========== ASSET YOLLARI (REPONA GÃ–RE) ========== */
const PLAYER_SRC = "img/player/bpc_mini.png";
const ENEMY_SRCS  = ["bpc_enemy_green.png","bpc_enemy_red.png","bpc_enemy_ufo_gray.png","bpc_enemy_ufo_red.png"];

/* ========== OYUN DURUMU ========== */
const bullets=[], enemies=[], gems=[];
let score=0, powerShots=0;
pxEl.textContent = powerShots;

const player = { x: cv.width/2-28, y: cv.height-110, w:56, h:56, speed:7 };
let holding=false;         // ekrana basÄ±lÄ± mÄ±
let autoTimer=0, FIRE_MS=180;
let keys={};

addEventListener('keydown', e=>{ keys[e.key.toLowerCase()]=true; });
addEventListener('keyup', e=>{ keys[e.key.toLowerCase()]=false; });

/* ========== KONTROLLER (Sade: dokunduÄŸun yere gider) ========== */
cv.addEventListener('pointerdown', e=>{
  holding=true;
  moveTo(e);
  shoot(true);           // basar basmaz ateÅŸ
});
cv.addEventListener('pointermove', e=>{
  if(!holding) return;
  moveTo(e);             // parmak neredeyse gemi oraya
});
cv.addEventListener('pointerup', ()=>{ holding=false; });

function moveTo(e){
  // EkranÄ±n neresine dokunursan dokun â†’ o noktaya gider
  player.x = Math.max(0, Math.min(cv.width - player.w, e.offsetX - player.w/2));
}

/* ========== OYUN MANTIÄžI ========== */
function addBullet(x, vy, ang){ bullets.push({ x, y:player.y-12, w:4, h:12, vy, ang }); }
function shoot(force=false){
  if(powerShots>0){
    addBullet(player.x+player.w/2-2, -10, 0);
    addBullet(player.x+player.w/2-2, -10, -3);
    addBullet(player.x+player.w/2-2, -10,  3);
    powerShots--; pxEl.textContent = powerShots;
  } else {
    addBullet(player.x+player.w/2-2, -10, 0);
  }
}

function spawnEnemy(){
  const img=enemiesImgs[Math.floor(Math.random()*enemiesImgs.length)];
  const size=52+Math.random()*30;
  enemies.push({x:Math.random()*(cv.width-size), y:-size, w:size, h:size, vy:1.5+Math.random()*2.2, img});
}
function spawnGem(){ const s=24; gems.push({x:Math.random()*(cv.width-s), y:-s, w:s, h:s, vy:1.8}); }
function rectHit(a,b){ return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h); }

let spawnT=0, gemT=0;
function update(dt){
  // Klavye ile de destek (isteÄŸe baÄŸlÄ±)
  if(keys['arrowleft']||keys['a'])  player.x = Math.max(0, player.x - player.speed);
  if(keys['arrowright']||keys['d']) player.x = Math.min(cv.width-player.w, player.x + player.speed);

  // BasÄ±lÄ±yken sÃ¼rekli ateÅŸ
  autoTimer += dt;
  const active = holding || keys['arrowleft'] || keys['arrowright'] || keys['a'] || keys['d'];
  if(active && autoTimer > FIRE_MS){ shoot(); autoTimer = 0; }

  // Mermi
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y+=b.vy; b.x+= (b.ang||0)*0.6;
    if(b.y<-20) bullets.splice(i,1);
  }

  // DÃ¼ÅŸman
  spawnT+=dt; if(spawnT>700){ spawnEnemy(); spawnT=0; }
  enemies.forEach(e=>e.y+=e.vy);
  for(let i=enemies.length-1;i>=0;i--) if(enemies[i].y>cv.height+50) enemies.splice(i,1);

  // Gem (power-up)
  gemT+=dt; if(gemT>5200){ spawnGem(); gemT=0; }
  gems.forEach(g=>g.y+=g.vy);
  for(let i=gems.length-1;i>=0;i--) if(gems[i].y>cv.height+40) gems.splice(i,1);

  // Ã‡arpÄ±ÅŸmalar
  // KurÅŸun â†” DÃ¼ÅŸman
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(rectHit({x:b.x,y:b.y,w:b.w,h:b.h},{x:e.x,y:e.y,w:e.w,h:e.h})){
        enemies.splice(i,1);
        bullets.splice(j,1);
        score++; scEl.textContent=score;
        break;
      }
    }
  }
  // Oyuncu â†” Gem
  for(let i=gems.length-1;i>=0;i--){
    const g=gems[i];
    if(rectHit(player,g)){
      gems.splice(i,1);
      powerShots += 3;    // 3 atÄ±ÅŸlÄ±k Ã¼Ã§lÃ¼ gÃ¼Ã§
      pxEl.textContent = powerShots;
    }
  }
}

function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);
  // oyuncu
  ctx.drawImage(playerImgKeyed, player.x, player.y, player.w, player.h);
  // mermiler
  ctx.fillStyle="#00ffc8"; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
  // dÃ¼ÅŸmanlar
  enemies.forEach(e=>ctx.drawImage(e.img, e.x, e.y, e.w, e.h));
  // yeÅŸil gÃ¶ltaÅŸÄ± (power-up)
  gems.forEach(g=>{
    const {x,y,w,h}=g; ctx.save(); ctx.translate(x+w/2,y+h/2); ctx.scale(w/30,h/30);
    ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(8,-2); ctx.lineTo(5,10); ctx.lineTo(-5,10); ctx.lineTo(-8,-2); ctx.closePath();
    ctx.fillStyle="#22c55e"; ctx.fill(); ctx.strokeStyle="#065f46"; ctx.lineWidth=1.8; ctx.stroke();
    ctx.beginPath(); ctx.moveTo(-3,-3); ctx.lineTo(0,-6); ctx.lineTo(3,-3); ctx.lineTo(0,0); ctx.closePath();
    ctx.fillStyle="#86efac"; ctx.fill(); ctx.restore();
  });
}

/* ========== DÃ–NGÃœ ========== */
let last=performance.now();
function loop(t){
  const dt = t-last; last=t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ========== PRELOAD ========== */
let playerImgKeyed, enemiesImgs=[];
(async function(){
  const p = await loadImage(PLAYER_SRC);
  playerImgKeyed = keyOutDark(p,80);
  for(const src of ENEMY_SRCS){
    const i = await loadImage(src);
    enemiesImgs.push(keyOutDark(i,80));
  }
})();
</script>
</body>
</html>
