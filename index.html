<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover" />
<title>BPC - ZIGZAG TEST MODE</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui;overflow:hidden}
  #ui{position:fixed;top:10px;left:10px;color:#00ffc8;font-weight:bold;z-index:10;font-size:14px;pointer-events:none;}
  canvas{display:block;width:100%;height:100%;background:#020617;}
  .btn{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:15px 30px;
       background:#0f172a;border:2px solid #00ffc8;color:#00ffc8;font-size:20px;
       font-weight:900;border-radius:10px;cursor:pointer;z-index:20;}
</style>
</head>
<body>

<div id="ui">
  TEST MODU: AKTİF<br>
  DURUM: ZIG-ZAG + MAX KALABALIK<br>
  Skor: <span id="sc">0</span>
</div>

<button id="startBtn" class="btn">TESTİ BAŞLAT</button>
<canvas id="game"></canvas>

<script>
const cv=document.getElementById("game");
const ctx=cv.getContext("2d");
const startBtn=document.getElementById("startBtn");
const scEl=document.getElementById("sc");

// RESİMLER VARSA YÜKLER, YOKSA KUTU ÇİZER
const PLAYER_SRC="img/player/bpc_mini.png";
const ENEMY_SRC=["bpc_enemy_red.png", "bpc_enemy_green.png"];
let playerImg=null, enemyImgs=[];

function resize(){ cv.width=window.innerWidth; cv.height=window.innerHeight; }
window.addEventListener('resize', resize); resize();

let player={x:cv.width/2-30,y:cv.height-120,w:60,h:60};
let bullets=[], enemies=[], particles=[];
let running=false, score=0, frames=0;

// === AYARLAR ===
const ENEMY_CAP = 30; // Index 67'deki maksimum sınır
const SPAWN_RATE = 20; // Çok sık düşman gelecek

// Resim yükleme (Varsa)
const loadImage=(src)=>new Promise((r)=>{const i=new Image();i.onload=()=>r(i);i.onerror=()=>r(null);i.src=src;});
(async ()=>{
  playerImg = await loadImage(PLAYER_SRC);
  for(let s of ENEMY_SRC) { const i = await loadImage(s); if(i) enemyImgs.push(i); }
})();

// KONTROLLER
let holding=false;
cv.addEventListener("pointerdown",e=>{holding=true;move(e);});
cv.addEventListener("pointermove",e=>{if(holding)move(e);});
cv.addEventListener("pointerup",()=>holding=false);
function move(e){
  const x=(e.clientX||e.touches[0].clientX);
  player.x = Math.max(0, Math.min(cv.width-player.w, x-player.w/2));
}

// OYUN DÖNGÜSÜ
function start(){
  startBtn.style.display="none";
  running=true; enemies=[]; bullets=[]; score=0;
  loop();
}
startBtn.onclick=start;

function spawnEnemy(){
  if(enemies.length >= ENEMY_CAP) return;
  
  const size = 50 + Math.random()*30; // Büyük düşmanlar
  const x = Math.random() * (cv.width - size);
  
  // === İŞTE ZIG-ZAG MEKANİĞİ ===
  // Index 67'de 2300 puanda açılan özellik burada hep açık
  const dir = Math.random() < 0.5 ? -1 : 1;
  const vx = dir * (1.5 + Math.random() * 2.5); // Yatay Hız (Sağ/Sol)

  enemies.push({
    x: x, y: -size, w: size, h: size,
    vy: 3 + Math.random() * 2, // Dikey Hız (Aşağı)
    vx: vx, // <-- Yatay Hareket Değişkeni
    color: Math.random()<0.5 ? "#ef4444" : "#22c55e"
  });
}

function update(){
  if(!running) return;
  frames++;

  // Otomatik Ateş
  if(frames % 10 === 0) bullets.push({x:player.x+player.w/2-2, y:player.y, w:4, h:15, color:"#38bdf8"});

  // Düşman Spawn
  if(frames % SPAWN_RATE === 0) spawnEnemy();

  // Mermi Hareketi
  bullets.forEach(b => b.y -= 10);
  bullets = bullets.filter(b => b.y > -20);

  // Düşman Hareketi
  enemies.forEach(e => {
    e.y += e.vy;
    
    // === ZIG-ZAG MANTIĞI ===
    e.x += e.vx; 
    // Duvara çarpınca yön değiştir (Bounce)
    if(e.x <= 0 || e.x + e.w >= cv.width){
       e.vx *= -1; 
    }
  });

  // Çarpışma Testi
  enemies.forEach((e, i) => {
    // Mermi vurdu mu?
    bullets.forEach((b, bi) => {
      if(b.x < e.x+e.w && b.x+b.w > e.x && b.y < e.y+e.h && b.y+b.h > e.y){
        enemies.splice(i, 1); bullets.splice(bi, 1);
        score++; scEl.innerText = score;
      }
    });
    
    // Oyuncuya çarptı mı?
    if(player.x < e.x+e.w && player.x+player.w > e.x && player.y < e.y+e.h && player.y+player.h > e.y){
      // Basitlik olsun diye ölümsüz yaptım, sadece kırmızı yanar
      ctx.fillStyle = "red"; ctx.fillRect(0,0,cv.width,cv.height);
    }
  });
  
  enemies = enemies.filter(e => e.y < cv.height);

  draw();
  requestAnimationFrame(update);
}

function draw(){
  // Arkaplanı temizle
  ctx.fillStyle = "rgba(2, 6, 23, 0.5)"; // Hafif iz kalsın (motion blur)
  ctx.fillRect(0,0,cv.width,cv.height);

  // Oyuncu
  if(playerImg) ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
  else { ctx.fillStyle="#38bdf8"; ctx.fillRect(player.x, player.y, player.w, player.h); }

  // Mermiler
  ctx.fillStyle="#00ffc8";
  bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

  // Düşmanlar
  enemies.forEach(e => {
    if(enemyImgs.length > 0) {
      // Rastgele bir resim seç (varsa)
      ctx.drawImage(enemyImgs[0], e.x, e.y, e.w, e.h);
    } else {
      ctx.fillStyle = e.color;
      ctx.fillRect(e.x, e.y, e.w, e.h);
      
      // Yön oku (Zig-zagı görmek için)
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText(e.vx > 0 ? "→" : "←", e.x + e.w/2 - 10, e.y + e.h/2 + 5);
    }
  });
}

</script>
</body>
</html>
