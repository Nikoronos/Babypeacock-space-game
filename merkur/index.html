<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Babypeacock ‚Äì Mars (Level 2)</title>
<style>
  :root{
    --hud-h:56px;
    --bg:#0b0f14;
    --mars:#6b2f1c;           /* taban */
    --mars2:#7a3a22;          /* yumu≈üak ton */
    --text:#cfe6ff;
    --brand:#5ec8ff;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:#000;color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
  header{
    height:var(--hud-h);
    display:flex;align-items:center;gap:14px;
    padding:10px 12px;background:rgba(0,0,0,.88);
    position:sticky;top:0;z-index:5;
  }
  header .brand{font-weight:800;font-size:26px;letter-spacing:.5px;color:#8db7ff}
  header .label{opacity:.85}
  header .score{font-weight:800;min-width:80px;text-align:left}
  header .hearts{margin-left:auto;font-size:26px;letter-spacing:2px}
  /* Canvas, ekrana ger√ßek pikselde oturur (scale yok) */
  #game{display:block;width:100vw;height:calc(100svh - var(--hud-h));margin:0 auto;touch-action:none;background:#000}
  /* Overlaylar */
  .overlay{
    position:fixed;inset:var(--hud-h) 0 0 0;display:grid;place-items:center;
    background:linear-gradient(180deg,rgba(0,0,0,.75),rgba(0,0,0,.55));z-index:10;
  }
  .card{
    background:#0e1116;border:1px solid #1f2630;border-radius:16px;padding:22px 20px;min-width:260px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);text-align:center
  }
  .card h1{margin:.2em 0 .6em;font-size:22px}
  .btn{
    background:#14b8a6;color:#041016;border:none;border-radius:12px;padding:12px 18px;
    font-weight:800;font-size:18px;cursor:pointer
  }
  .hint{opacity:.8;margin-top:10px;font-size:13px}
  /* HUD k√º√ß√ºk emojiler */
  .hud-emoji{filter:drop-shadow(0 0 6px rgba(94,200,255,.35))}
</style>
</head>
<body>
  <header>
    <div class="brand">Babypeacock <span class="hud-emoji">ü¶ö</span></div>
    <div class="label">Mars (Level 2)</div>
    <div class="label">SCORE:</div><div id="score" class="score">0</div>
    <div id="gemTimer" class="label">üíé <span id="gemSec">0</span>s</div>
    <div id="hearts" class="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  </header>

  <canvas id="game"></canvas>

  <div id="startOv" class="overlay">
    <div class="card">
      <h1>Mars G√∂revi</h1>
      <p>Green(2), Yellow(3), White(3), Red(5). √áarpƒ±nca can gider.<br/>üíé = 15sn √º√ßl√º ate≈ü.</p>
      <button id="startBtn" class="btn">START</button>
      <div class="hint">S√ºr√ºkle veya parmakla hareket ‚Äî atƒ±≈ü otomatik</div>
    </div>
  </div>

  <div id="gameOverOv" class="overlay" style="display:none">
    <div class="card">
      <h1>GAME OVER</h1>
      <div style="margin:8px 0 16px">Skor: <b id="finalScore">0</b></div>
      <button id="retryBtn" class="btn">RETRY</button>
    </div>
  </div>

<script>
/* ------------------ KURULUM ------------------ */
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
let W=0, H=0, DPR=1;

function resizeCanvas(){
  DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  const w = window.innerWidth;
  const h = Math.max(480, window.innerHeight - document.querySelector('header').offsetHeight);
  cvs.style.width = w+'px';
  cvs.style.height = h+'px';
  cvs.width  = Math.floor(w * DPR);
  cvs.height = Math.floor(h * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
  W = w; H = h;
  if (player) { player.y = Math.min(player.y, H-90); }
}
addEventListener('resize', resizeCanvas);

/* ------------------ VARLIKLAR ------------------ */
function loadImg(src){ const i=new Image(); i.src=src; return i; }
const ASSETS = {
  player: loadImg('../img/player/bpc_mini.png'),
  green:  loadImg('../mars_enemy_green.png'),
  yellow: loadImg('../mars_enemy_yellow.png'),
  white:  loadImg('../mars_enemy_white.png'),
  red:    loadImg('../bpc_enemy_red.png') // repo'da var
};

/* ------------------ OYUN DURUMU ------------------ */
let running=false, started=false;
let score=0, lives=3;
let bullets=[], enemies=[], eBullets=[], particles=[];
let spawnTimer=0, levelUp=0, t=0;
let tripleUntil=0; // ms
const scoreEl = document.getElementById('score');
const heartsEl= document.getElementById('hearts');
const gemSecEl= document.getElementById('gemSec');

const player = {
  x: 0, y: 0, w: 44, h: 44, speed: 360,
  fireCd: 0, fireRate: 110, // ms
};

function resetGame(){
  score=0; lives=3; bullets.length=0; enemies.length=0; eBullets.length=0; particles.length=0;
  spawnTimer=0; levelUp=0; t=performance.now(); tripleUntil=0;
  scoreEl.textContent='0'; heartsEl.textContent='‚ù§Ô∏è'.repeat(lives);
  player.x = W*0.5; player.y = H-90;
}

/* ------------------ Gƒ∞Rƒ∞≈û ------------------ */
let pointer=null;
cvs.addEventListener('pointerdown', (e)=>{ pointer={id:e.pointerId, x:e.clientX, y:e.clientY}; movePlayer(e); });
cvs.addEventListener('pointermove', (e)=>{ if(pointer && pointer.id===e.pointerId) movePlayer(e); });
addEventListener('pointerup',   (e)=>{ if(pointer && pointer.id===e.pointerId) pointer=null;});
function movePlayer(e){
  const rect = cvs.getBoundingClientRect();
  const x = (e.clientX - rect.left);
  const y = (e.clientY - rect.top);
  player.x = Math.max(24, Math.min(W-24, x));
  player.y = Math.max(24, Math.min(H-24, y));
}

/* ------------------ YARDIMCI ------------------ */
function rand(a,b){return Math.random()*(b-a)+a}
function chance(p){return Math.random()<p}
function clamp(v,a,b){return v<a?a:v>b?b:v}
function addParticles(x,y,col,count=12){
  for(let i=0;i<count;i++){
    particles.push({x,y, vx:rand(-140,140), vy:rand(-220,40), r:rand(2,4), life:rand(300,600), c:col});
  }
}

/* ------------------ ARKA PLAN (Mars) ------------------ */
let bgOffset=0;
function drawMars(dt){
  bgOffset += dt*40;
  ctx.fillStyle='#2a160f';
  ctx.fillRect(0,0,W,H);

  // yumu≈üak degrade
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#5c2617');
  g.addColorStop(1,'#7c3a24');
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  // ince kum benekleri
  ctx.fillStyle='rgba(0,0,0,.25)';
  for(let i=0;i<80;i++){
    const x = (i*83.7 + (bgOffset*0.8))% (W+40) - 20;
    const y = (i*57.3*1.1 + (bgOffset*1.1))% (H+40) - 20;
    ctx.fillRect(x,y,2,2);
  }

  // ufak dalgalar (√ßok ince)
  ctx.strokeStyle='rgba(255,214,170,.12)';
  ctx.lineWidth=2;
  for(let i=0;i<4;i++){
    const y = ((i*H/4) + (H - (bgOffset%H)) )%H;
    ctx.beginPath();
    ctx.moveTo(0,y);
    for(let x=0;x<=W;x+=24){
      const yy = y + Math.sin((x+bgOffset*0.2)*0.02)*3;
      ctx.lineTo(x,yy);
    }
    ctx.stroke();
  }
}

/* ------------------ D√ú≈ûMAN ------------------ */
const ENEMY = {
  green:{ img:()=>ASSETS.green,  hp:1,  spMin:60, spMax:120, fire:false, points:2,  },
  yellow:{img:()=>ASSETS.yellow, hp:1,  spMin:90, spMax:160, fire:true,  fireRate:900, bullet:'#f8d34b',  points:3 },
  white:{ img:()=>ASSETS.white,  hp:2,  spMin:80, spMax:140, fire:true,  fireRate:950, dual:true, bullet:'#f1f1f1', points:3 },
  red:{   img:()=>ASSETS.red,    hp:3,  spMin:70, spMax:120, fire:true,  fireRate:750, bullet:'#ff3b3b',  points:5 },
};
function spawnEnemy(){
  // zorluk, skorla artar
  const s = score;
  let pool = ['green','green','yellow','green','white'];
  if (s>120) pool.push('red');
  if (s>280) pool.push('red','yellow','white');

  const type = pool[Math.floor(Math.random()*pool.length)];
  const spec = ENEMY[type];
  enemies.push({
    type, hp: spec.hp, img:spec.img(),
    x: rand(28, W-28), y: -60,
    vy: rand(spec.spMin, spec.spMax),
    fireCd: 0,
  });
}

/* ------------------ √áATI≈ûMA ------------------ */
function collRect(a,b){ return Math.abs(a.x-b.x) < (a.w+b.w)*0.5 && Math.abs(a.y-b.y) < (a.h+b.h)*0.5; }

/* ------------------ OYUN D√ñNG√úS√ú ------------------ */
function loop(now){
  if(!running) return;
  const dt = (now - t)/1000; t = now;

  drawMars(dt);

  // Oyuncu otomatik atƒ±≈ü
  player.fireCd -= dt*1000;
  const fireNow = player.fireCd<=0;
  if (fireNow){
    player.fireCd = player.fireRate;
    const triple = now < tripleUntil;
    const offs = triple ? [-10,0,10] : [0];
    for(const ox of offs){
      bullets.push({x:player.x+ox, y:player.y-22, vy:-520, r:3, c:'#6cd3ff'});
    }
  }
  // Oyuncu √ßiz
  const pImg = ASSETS.player; const pw=52, ph=52;
  player.w=pw; player.h=ph;
  ctx.drawImage(pImg, player.x-pw/2, player.y-ph/2, pw, ph);

  // Oyuncu mermileri
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y += b.vy*dt;
    ctx.fillStyle=b.c; ctx.fillRect(b.x-2,b.y-8,4,12);
    if (b.y<-20) bullets.splice(i,1);
  }

  // D√º≈üman √ºretimi
  spawnTimer -= dt;
  if(spawnTimer<=0){
    spawnEnemy();
    const base = 0.9, minGap = 0.28;       // skor arttƒ±k√ßa hƒ±zlan
    const factor = clamp(1 - score/800, minGap, 1);
    spawnTimer = base*factor;
  }

  // D√º≈ümanlar
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i]; const spec=ENEMY[e.type];
    e.y += e.vy*dt;

    // Ate≈ü
    if (spec.fire){
      e.fireCd -= dt*1000;
      if (e.fireCd<=0 && e.y>40){
        e.fireCd = spec.fireRate * clamp(1 - score/900, .55, 1);
        if (spec.dual){
          eBullets.push({x:e.x-18,y:e.y+18,vy:240,c:spec.bullet});
          eBullets.push({x:e.x+18,y:e.y+18,vy:240,c:spec.bullet});
        }else{
          eBullets.push({x:e.x,y:e.y+18,vy: (e.type==='red'? 320:260), c:spec.bullet});
        }
      }
    }

    // √áiz
    const w=56, h=56; e.w=w; e.h=h;
    ctx.drawImage(e.img, e.x-w/2, e.y-h/2, w, h);

    // Oyuncu √ßarpƒ±≈üma
    if (collRect({x:e.x,y:e.y,w,h},{x:player.x,y:player.y,w:pw,h:ph})){
      addParticles(e.x,e.y, '#ff6b6b', 18);
      enemies.splice(i,1);
      hitPlayer();
      continue;
    }
    // Ekran dƒ±≈üƒ±
    if (e.y > H+60) { enemies.splice(i,1); continue; }

    // Mermi √ßarpƒ±≈üma
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if (Math.abs(b.x-e.x)<28 && Math.abs(b.y-e.y)<28){
        bullets.splice(j,1);
        e.hp--;
        if (e.hp<=0){
          score += spec.points; scoreEl.textContent=score;
          const col = (e.type==='green')? '#86efac' : (e.type==='yellow')? '#facc15' : (e.type==='white')? '#e5e7eb' : '#ff6b6b';
          addParticles(e.x,e.y,col, 20);
          enemies.splice(i,1);
        }
        break;
      }
    }
  }

  // D√º≈üman mermileri
  for(let i=eBullets.length-1;i>=0;i--){
    const b=eBullets[i]; b.y += b.vy*dt;
    ctx.fillStyle=b.c; ctx.fillRect(b.x-2,b.y-6,4,10);
    if (b.y>H+20) { eBullets.splice(i,1); continue; }
    if (Math.abs(b.x-player.x)<18 && Math.abs(b.y-player.y)<18){
      eBullets.splice(i,1);
      hitPlayer(); continue;
    }
  }

  // Partik√ºller
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.life -= dt*1000; if (p.life<=0){particles.splice(i,1); continue;}
    p.x += p.vx*dt; p.y += p.vy*dt; p.vy += 420*dt*0.25;
    ctx.fillStyle=p.c; ctx.globalAlpha = Math.max(0, p.life/600);
    ctx.fillRect(p.x-2,p.y-2,4,4); ctx.globalAlpha=1;
  }

  // G√º√ßlendirme s√ºresi g√∂stergesi
  const remain = Math.max(0, Math.floor((tripleUntil - now)/1000));
  gemSecEl.textContent = remain;

  // Nadiren üíé bƒ±rak
  if (chance(0.0015 + Math.min(0.003, score/8000))){
    drops.push({x:rand(30,W-30), y:-20, vy:110});
  }
  // Drop'lar
  for(let i=drops.length-1;i>=0;i--){
    const d=drops[i]; d.y += d.vy*dt;
    ctx.font='20px system-ui'; ctx.fillStyle='#9ee5ff'; ctx.fillText('üíé', d.x-10, d.y+6);
    if (d.y>H+30){ drops.splice(i,1); continue; }
    if (Math.abs(d.x-player.x)<18 && Math.abs(d.y-player.y)<18){
      tripleUntil = performance.now() + 15000;
      drops.splice(i,1);
    }
  }

  requestAnimationFrame(loop);
}

function hitPlayer(){
  lives--; heartsEl.textContent='‚ù§Ô∏è'.repeat(Math.max(0,lives));
  addParticles(player.x, player.y, '#ff6961', 26);
  if (lives<=0){ gameOver(); }
}

/* ------------------ Drop nesneleri ------------------ */
const drops=[];

/* ------------------ BA≈ûLAT / Bƒ∞Tƒ∞R ------------------ */
function startGame(){
  document.getElementById('startOv').style.display='none';
  document.getElementById('gameOverOv').style.display='none';
  started=true; running=true;
  resizeCanvas(); resetGame(); t=performance.now();
  requestAnimationFrame(loop);
}
function gameOver(){
  running=false;
  document.getElementById('finalScore').textContent=score;
  document.getElementById('gameOverOv').style.display='grid';
}

/* ------------------ OLAYLAR ------------------ */
document.getElementById('startBtn').onclick = startGame;
document.getElementById('retryBtn').onclick = startGame;

/* ƒ∞lk kurulum */
resizeCanvas();
</script>
</body>
</html>
