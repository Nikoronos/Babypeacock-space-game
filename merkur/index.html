<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Babypeacock â€¢ Mars (Level 2)</title>
<style>
  :root{
    --uiH: 44px;
  }
  html,body{margin:0;height:100%;background:#0a0f11;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}
  /* ÃœST BAR */
  #hud{
    position:fixed;left:0;top:0;right:0;height:var(--uiH);
    display:flex;align-items:center;gap:16px;padding:6px 12px;
    background:linear-gradient(#0b0f15,#0b0f15cc);
    -webkit-user-select:none;user-select:none;z-index:5
  }
  #title{font-weight:800;letter-spacing:.3px}
  #score{margin-left:auto;font-weight:800}
  #hearts{font-size:22px}
  /* CANVAS: ekranÄ± taÅŸÄ±rmadan Ã¶lÃ§ekle */
  canvas{
    display:block;margin:var(--uiH) auto 0;
    max-width:420px;width:100vw;height:auto;touch-action:none;
    background:#2b1a14 /* JSâ€™de Mars yÃ¼zeyi boyanacak; bu sadece gÃ¼venlik */
  }
  /* OVERLAYS */
  .overlay{
    position:fixed;inset:0;display:none;place-items:center;z-index:10;
    background:rgba(0,0,0,.55)
  }
  .card{
    background:#071219;border:1px solid #163042;border-radius:14px;
    padding:22px 26px;box-shadow:0 10px 30px rgba(0,0,0,.35);text-align:center
  }
  .btn{background:#0db5a6;border:0;color:#001015;font-weight:800;
       padding:10px 18px;border-radius:12px;font-size:16px;cursor:pointer}
  .big{font-size:28px;font-weight:900;letter-spacing:.6px;margin:8px 0 14px}
</style>
</head>
<body>

<div id="hud">
  <div id="title">Babypeacock ðŸ¦š</div>
  <div>Mars (Level 2)</div>
  <div id="score">SCORE: 0</div>
  <div id="hearts">ðŸ’—ðŸ’—ðŸ’—</div>
</div>

<canvas id="cv" width="420" height="720"></canvas>

<!-- GAME OVER -->
<div id="over" class="overlay">
  <div class="card">
    <div class="big" id="overText">GAME OVER</div>
    <button class="btn" id="retryBtn">RETRY</button>
  </div>
</div>

<script>
/* ========= CANVAS & STATE ========= */
const cvs = document.getElementById('cv');
const ctx = cvs.getContext('2d');
ctx.imageSmoothingEnabled = false;

const W = cvs.width, H = cvs.height;

const uiScore = document.getElementById('score');
const uiHearts = document.getElementById('hearts');
const over = document.getElementById('over');
const overText = document.getElementById('overText');
const retryBtn = document.getElementById('retryBtn');

let running = true, lastT = 0;

/* ========= ASSETS ========= */
const imgPlayer = new Image(); imgPlayer.src = 'img/player/bpc_mini.png';
const imgG = new Image(); imgG.src = 'mars_enemy_green.png';
const imgY = new Image(); imgY.src = 'mars_enemy_yellow.png';
const imgW = new Image(); imgW.src = 'mars_enemy_white.png';
const imgBoss = new Image(); imgBoss.src = 'mars_enemy_bigger_green.png';

/* ========= PLAYER ========= */
const player = {
  x: W/2, y: H-80, w: 52, h: 52, speed: 3.2,
  fireCD: 0, lives: 3
};
let bullets = [];        // player bullets
let eBullets = [];       // enemy/boss bullets
let enemies = [];
let score = 0;

/* ========= BOSS ========= */
let boss = {
  active:false, x:W/2, y:80, w:160, h:160, hp: 120,
  t:0, fireCD:0
};

/* ========= INPUT ========= */
const keys = {};
addEventListener('keydown', e=>{ keys[e.key] = true; });
addEventListener('keyup', e=>{ keys[e.key] = false; });
cvs.addEventListener('pointermove', e=>{
  const r = cvs.getBoundingClientRect();
  const px = (e.clientX - r.left) * (cvs.width/r.width);
  player.x = Math.min(W-26, Math.max(26, px));
});

/* ========= HELPERS ========= */
function rectHit(a,b){
  return Math.abs(a.x-b.x) < (a.w+b.w)/2 && Math.abs(a.y-b.y) < (a.h+b.h)/2;
}
function addScore(v){ score += v; uiScore.textContent = 'SCORE: '+score; }
function setHearts(){
  uiHearts.textContent = 'ðŸ’—'.repeat(Math.max(0,player.lives));
}
function endGame(text){
  running = false;
  overText.textContent = text;
  over.style.display = 'grid';
}
retryBtn.onclick = ()=>location.reload();

/* ========= SPAWN ========= */
function spawnEnemy(){
  // yoÄŸunluÄŸu orta â€“ boss yoksa gÃ¶reli sÄ±k
  if (boss.active) return;
  const lane = Math.floor(Math.random()*6)+1;
  const x = (W/7)*lane;
  const rnd = Math.random();
  let type='g', img=imgG, w=44,h=44, sp=0.8, hp=1, fire=0;
  if(rnd>0.72 && rnd<=0.9){ type='y'; img=imgY; w=48; h=48; sp=1.0; hp=1; fire=0.35; }
  else if(rnd>0.9){ type='w'; img=imgW; w=56; h=56; sp=0.9; hp=2; fire=0.55; }

  enemies.push({type,img,x,y:-40,w,h,vy:sp,hp,fireCD:0});
}

/* ========= BACKGROUND ========= */
function drawMars(bossMode){
  // topraÄŸÄ± katman katman boya
  ctx.fillStyle = '#6b2f1c'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle = '#7d3b20';
  for(let i=0;i<6;i++) ctx.fillRect(0, i*120+50, W, 6);
  // kÃ¼Ã§Ã¼k taÅŸlar
  ctx.fillStyle = '#2a120c';
  for(let i=0;i<120;i++){
    const x = (i*37 + (Date.now()/80|0))%W;
    const y = (i*59)%H;
    ctx.fillRect(x, y, 2, 2);
  }
  if(bossMode){
    // daÄŸ siluetleri
    ctx.fillStyle = '#4a2418';
    for(let i=0;i<3;i++){
      const bx = (i*150 + (Date.now()/30|0))% (W+200) - 200;
      ctx.beginPath();
      ctx.moveTo(bx, H-140);
      ctx.lineTo(bx+120, H-260);
      ctx.lineTo(bx+260, H-140);
      ctx.closePath(); ctx.fill();
    }
  }
}

/* ========= GAME LOOP ========= */
function loop(t){
  if(!running) return;
  const dt = Math.min(40, t-lastT); lastT = t;

  // arka plan
  drawMars(boss.active);

  /* ---- input & player ---- */
  if(keys['ArrowLeft'])  player.x -= player.speed;
  if(keys['ArrowRight']) player.x += player.speed;
  if(keys['ArrowUp'])    player.y -= player.speed;
  if(keys['ArrowDown'])  player.y += player.speed;
  player.x = Math.max(26, Math.min(W-26, player.x));
  player.y = Math.max(60, Math.min(H-40, player.y));

  // ateÅŸ
  player.fireCD -= dt;
  if(keys[' '] || keys['Space'] || keys['Enter']){
    if(player.fireCD<=0){
      bullets.push({x:player.x, y:player.y-24, w:6,h:14, vy:-4.2, color:'#66d6ff'});
      player.fireCD = 130;
    }
  }

  // player draw
  if(imgPlayer.complete) ctx.drawImage(imgPlayer, player.x-player.w/2, player.y-player.h/2, player.w, player.h);
  else { // yedek Ã¼Ã§gen
    ctx.fillStyle='#20b7d7';
    ctx.beginPath(); ctx.moveTo(player.x,player.y-18); ctx.lineTo(player.x-14,player.y+18); ctx.lineTo(player.x+14,player.y+18); ctx.closePath(); ctx.fill();
  }

  /* ---- spawn enemies ---- */
  if(!boss.active && Math.random()<0.025) spawnEnemy();

  /* ---- update enemies ---- */
  for(let i=enemies.length-1;i>=0;i--){
    const e = enemies[i];
    e.y += e.vy* (1+score/1200); // hafif hÄ±z artÄ±ÅŸÄ±
    // white iki kanat atÄ±ÅŸÄ±
    e.fireCD -= dt;
    if(e.type==='w' && e.fireCD<=0){
      eBullets.push({x:e.x- e.w*0.35, y:e.y+e.h*0.2, w:6,h:14, vy:2.2, color:'#ffffff'});
      eBullets.push({x:e.x+ e.w*0.35, y:e.y+e.h*0.2, w:6,h:14, vy:2.2, color:'#ffffff'});
      e.fireCD = 800;
    }
    // yellow tek atÄ±ÅŸ
    if(e.type==='y' && Math.random()<0.012){
      eBullets.push({x:e.x, y:e.y+e.h*0.2, w:6,h:14, vy:2.4, color:'#ffd12a'});
    }
    // Ã§arpÄ±ÅŸma oyuncu
    if(rectHit({x:e.x,y:e.y,w:e.w,h:e.h}, player)){
      enemies.splice(i,1);
      if(--player.lives<=0){ setHearts(); return endGame('GAME OVER'); }
      setHearts();
      continue;
    }
    // mermiye vurulma
    let killed=false;
    for(let j=bullets.length-1;j>=0;j--){
      const b = bullets[j];
      if(rectHit({x:e.x,y:e.y,w:e.w,h:e.h}, b)){
        bullets.splice(j,1);
        if(--e.hp<=0){
          enemies.splice(i,1); killed=true;
          // patlama rengi
          spawnExplosion(e.x,e.y, e.type==='y'?'#ffd12a':(e.type==='w'?'#ffffff':'#58c04d'));
          addScore(e.type==='y'?4:(e.type==='w'?5:2));
        }
        break;
      }
    }
    if(!killed){
      // ekrana Ã§iz
      if(e.img.complete) ctx.drawImage(e.img, e.x-e.w/2, e.y-e.h/2, e.w, e.h);
      else { ctx.fillStyle='#ccc'; ctx.fillRect(e.x-e.w/2, e.y-e.h/2, e.w, e.h); }
    }
    // ekrandan Ã§Ä±ktÄ±ysa
    if(e.y - e.h/2 > H) enemies.splice(i,1);
  }

  /* ---- player bullets ---- */
  for(let i=bullets.length-1;i>=0;i--){
    const b = bullets[i]; b.y += b.vy;
    if(b.y < -20) { bullets.splice(i,1); continue; }
    ctx.fillStyle = b.color; ctx.fillRect(b.x-3, b.y-10, 6, 14);
  }

  /* ---- enemy bullets ---- */
  for(let i=eBullets.length-1;i>=0;i--){
    const b = eBullets[i]; b.y += b.vy;
    if(rectHit(player,b)){
      eBullets.splice(i,1);
      if(--player.lives<=0){ setHearts(); return endGame('GAME OVER'); }
      setHearts();
      continue;
    }
    if(b.y > H+20) { eBullets.splice(i,1); continue; }
    ctx.fillStyle = b.color; ctx.fillRect(b.x-3, b.y-10, 6, 14);
  }

  /* ---- boss appear @ 500 ---- */
  if(!boss.active && score >= 500){
    boss.active = true;
    boss.x = W/2; boss.y = 110; boss.w = 140; boss.h = 140; // kÃ¼Ã§Ã¼ltÃ¼lmÃ¼ÅŸ
    boss.hp = 180; boss.t = 0; boss.fireCD = 0;
  }

  if(boss.active){
    boss.t += dt;
    boss.x = W/2 + Math.sin(boss.t*0.002)* (W*0.35);

    // kÄ±sa kÄ±rmÄ±zÄ± lazer
    boss.fireCD -= dt;
    if(boss.fireCD<=0){
      const lx = boss.x, ly = boss.y + boss.h*0.25;
      eBullets.push({x:lx-28, y:ly, w:5,h:22, vy:3.2, color:'#ff4343'});
      eBullets.push({x:lx+28, y:ly, w:5,h:22, vy:3.2, color:'#ff4343'});
      boss.fireCD = 420;
    }

    // player Ã§arpÄ±ÅŸmasÄ±
    if(rectHit(boss, player)){
      if(--player.lives<=0){ setHearts(); return endGame('GAME OVER'); }
      setHearts();
    }

    // mermi hasarÄ±
    for(let i=bullets.length-1;i>=0;i--){
      const b = bullets[i];
      if(rectHit(boss,b)){ bullets.splice(i,1); boss.hp -= 2; spawnExplosion(b.x,b.y,'#ff7575',10); }
    }

    // boss Ã§iz
    if(imgBoss.complete) ctx.drawImage(imgBoss, boss.x-boss.w/2, boss.y-boss.h/2, boss.w, boss.h);
    else { ctx.fillStyle='#1f4'; ctx.fillRect(boss.x-boss.w/2, boss.y-boss.h/2, boss.w, boss.h); }

    // HP bar
    ctx.fillStyle='#0f0'; const bw = Math.max(0, (boss.hp/180)*W);
    ctx.fillRect(0, 6, bw, 6);
    ctx.fillStyle='#0007'; ctx.fillRect(0,6,W,6);

    if(boss.hp<=0){
      // 3-4 kez patlat, sonra tebrik
      chainExplode(boss.x,boss.y);
      boss.active=false;
      setTimeout(()=>endGame('CONGRATULATIONS!'), 1200);
    }
  }

  requestAnimationFrame(loop);
}

/* ========= EXPLOSIONS ========= */
let particles=[];
function spawnExplosion(x,y,color='#58c04d',count=22){
  for(let i=0;i<count;i++){
    particles.push({
      x,y, vx:(Math.random()*2-1)*2.2, vy:(Math.random()*2-1)*2.2,
      life: 400 + Math.random()*300, color, size: 2+Math.random()*2
    });
  }
}
function chainExplode(x,y){
  for(let k=0;k<4;k++){
    setTimeout(()=>spawnExplosion(x+(Math.random()*80-40), y+(Math.random()*60-30), '#ff7575', 36), k*200);
  }
}
(function particlesLoop(){
  requestAnimationFrame(particlesLoop);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.life-=16; p.x+=p.vx; p.y+=p.vy; p.vy+=0.02;
    ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.size,p.size);
    if(p.life<=0) particles.splice(i,1);
  }
})();

/* ========= INIT ========= */
setHearts();
requestAnimationFrame(loop);
</script>
</body>
</html>
