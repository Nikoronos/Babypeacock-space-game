<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Babypeacock ‚Ä¢ Mars (Level 2)</title>
<style>
  :root{ --uiH:46px; }
  html,body{margin:0;height:100%;background:#0a0f11;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}
  #hud{
    position:fixed;inset:0 0 auto 0;height:var(--uiH);
    display:flex;align-items:center;gap:14px;padding:6px 12px;
    background:linear-gradient(#0b0f15,#0b0f15cc);z-index:5
  }
  #title{font-weight:900;letter-spacing:.3px}
  #score{margin-left:auto;font-weight:900}
  #hearts{font-size:22px}
  canvas{
    display:block;margin:var(--uiH) auto 0;
    max-width:420px;width:100vw;height:auto;touch-action:none;background:#5b2b1b
  }
  .overlay{position:fixed;inset:0;display:none;place-items:center;z-index:10;background:rgba(0,0,0,.55)}
  .card{background:#071219;border:1px solid #163042;border-radius:14px;padding:22px 26px;box-shadow:0 10px 30px rgba(0,0,0,.35);text-align:center}
  .btn{background:#0db5a6;border:0;color:#001015;font-weight:800;padding:10px 18px;border-radius:12px;font-size:16px;cursor:pointer}
  .big{font-size:28px;font-weight:900;letter-spacing:.6px;margin:8px 0 14px}
</style>
</head>
<body>
<div id="hud">
  <div id="title">Babypeacock ü¶ö</div>
  <div>Mars (Level 2)</div>
  <div id="score">SCORE: 0</div>
  <div id="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
</div>

<canvas id="cv" width="420" height="720"></canvas>

<div id="over" class="overlay">
  <div class="card">
    <div class="big" id="overText">GAME OVER</div>
    <button class="btn" id="retryBtn">RETRY</button>
  </div>
</div>

<script>
/* ===== temel ===== */
const cvs = document.getElementById('cv');
const ctx = cvs.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled = false;
const W=cvs.width,H=cvs.height;
const uiScore=document.getElementById('score');
const uiHearts=document.getElementById('hearts');
const over=document.getElementById('over');
const overText=document.getElementById('overText');
document.getElementById('retryBtn').onclick=()=>location.reload();

let running=true,lastT=0,score=0;

/* ===== sprites (merkur/ altƒ±ndan yollar) ===== */
const imgPlayer=new Image(); imgPlayer.src='../img/player/bpc_mini.png';
const imgG=new Image(); imgG.src='../mars_enemy_green.png';
const imgY=new Image(); imgY.src='../mars_enemy_yellow.png';
const imgW=new Image(); imgW.src='../mars_enemy_white.png';
const imgBoss=new Image(); imgBoss.src='../mars_enemy_bigger_green.png';

/* ===== player & state ===== */
const player={x:W/2,y:H-78,w:60,h:60,s:3.1,fireCD:0,lives:3};
let bullets=[],eBullets=[],enemies=[],parts=[];
const keys={};
addEventListener('keydown',e=>{keys[e.key]=true});
addEventListener('keyup',e=>{keys[e.key]=false});
cvs.addEventListener('pointermove',e=>{
  const r=cvs.getBoundingClientRect();
  const px=(e.clientX-r.left)*(cvs.width/r.width);
  player.x=Math.min(W-28,Math.max(28,px));
});
const hit=(a,b)=>Math.abs(a.x-b.x)<(a.w+b.w)/2&&Math.abs(a.y-b.y)<(a.h+b.h)/2;
const setScore=v=>uiScore.textContent='SCORE: '+(score=v);
const setHearts=()=>uiHearts.textContent='‚ù§Ô∏è'.repeat(Math.max(0,player.lives));
const endGame=txt=>{running=false;overText.textContent=txt;over.style.display='grid'};

/* ===== mars zemini ===== */
function drawMars(bossMode){
  ctx.fillStyle='#6b2f1c'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#2a120c';
  for(let i=0;i<140;i++){
    const x=(i*37 + (Date.now()/70|0))%W;
    const y=(i*53)%H;
    ctx.fillRect(x,y,2,2);
  }
  if(bossMode){
    ctx.fillStyle='#4a2418';
    for(let i=0;i<3;i++){
      const bx=(i*160 + (Date.now()/35|0))%(W+220)-220;
      ctx.beginPath();
      ctx.moveTo(bx,H-150); ctx.lineTo(bx+120,H-260); ctx.lineTo(bx+260,H-150);
      ctx.closePath(); ctx.fill();
    }
  }
}

/* ===== patlama par√ßacƒ±klarƒ± ===== */
function explode(x,y,color='#58c04d',n=22){
  for(let i=0;i<n;i++) parts.push({x,y,vx:(Math.random()*2-1)*2.2,vy:(Math.random()*2-1)*2.2,life:420+Math.random()*300,color,size:2+Math.random()*2});
}
function drawParts(){
  for(let i=parts.length-1;i>=0;i--){
    const p=parts[i]; p.life-=16; p.x+=p.vx; p.y+=p.vy; p.vy+=.02;
    ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.size,p.size);
    if(p.life<=0) parts.splice(i,1);
  }
}

/* ===== spawn ===== */
function spawnEnemy(){
  if(boss.active) return;
  if(Math.random()>0.035) return; // yoƒüunluk dengesi
  const lane=Math.floor(Math.random()*6)+1;
  const x=(W/7)*lane;
  const r=Math.random();
  let type='g',img=imgG,w=52,h=52,vy=1.05,hp=1,fire=0;
  if(r>0.7&&r<=0.9){type='y';img=imgY;w=56;h=56;vy=1.2;hp=1;fire=0.35}
  else if(r>0.9){type='w';img=imgW;w=64;h=64;vy=1.08;hp=2;fire=0.55}
  enemies.push({type,img,x,y:-40,w,h,vy,hp,fireCD:0});
}

/* ===== boss ===== */
let boss={active:false,x:W/2,y:110,w:140,h:140,hp:180,t:0,fireCD:0};

/* ===== loop ===== */
function loop(t){
  if(!running) return;
  const dt=Math.min(40,t-lastT); lastT=t;

  drawMars(boss.active);

  // hareket
  if(keys['ArrowLeft'])  player.x-=player.s;
  if(keys['ArrowRight']) player.x+=player.s;
  if(keys['ArrowUp'])    player.y-=player.s;
  if(keys['ArrowDown'])  player.y+=player.s;
  player.x=Math.max(28,Math.min(W-28,player.x));
  player.y=Math.max(64,Math.min(H-40,player.y));

  // ate≈ü (otomatik)
  player.fireCD-=dt;
  if(player.fireCD<=0){
    bullets.push({x:player.x,y:player.y-24,w:6,h:14,vy:-4.4,color:'#66d6ff'});
    player.fireCD=140;
  }

  // oyuncu √ßiz
  if(imgPlayer.complete) ctx.drawImage(imgPlayer,player.x-player.w/2,player.y-player.h/2,player.w,player.h);
  else {ctx.fillStyle='#20b7d7';ctx.beginPath();ctx.moveTo(player.x,player.y-18);ctx.lineTo(player.x-14,player.y+18);ctx.lineTo(player.x+14,player.y+18);ctx.closePath();ctx.fill();}

  // spawn
  spawnEnemy();

  // d√º≈ümanlar
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i]; e.y+=e.vy*(1+score/1200);
    e.fireCD-=dt;

    if(e.type==='w' && e.fireCD<=0){
      // white: iki kanat altƒ± beyaz lazer
      eBullets.push({x:e.x-e.w*0.35,y:e.y+e.h*0.2,w:6,h:14,vy:2.2,color:'#ffffff'});
      eBullets.push({x:e.x+e.w*0.35,y:e.y+e.h*0.2,w:6,h:14,vy:2.2,color:'#ffffff'});
      e.fireCD=800;
    }
    if(e.type==='y' && Math.random()<0.012){
      // yellow: tek sarƒ± atƒ±≈ü
      eBullets.push({x:e.x,y:e.y+e.h*0.2,w:6,h:14,vy:2.4,color:'#ffd12a'});
    }

    if(hit(e,player)){
      enemies.splice(i,1);
      if(--player.lives<=0){setHearts();return endGame('GAME OVER');}
      setHearts(); continue;
    }

    // player mermisi √ßarpƒ±≈ümasƒ±
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(hit(e,b)){
        bullets.splice(j,1);
        if(--e.hp<=0){
          enemies.splice(i,1);
          explode(e.x,e.y,e.type==='y'?'#ffd12a':(e.type==='w'?'#ffffff':'#58c04d'));
          setScore(score+(e.type==='y'?4:(e.type==='w'?5:2)));
        }
        break;
      }
    }

    if(e.img.complete) ctx.drawImage(e.img,e.x-e.w/2,e.y-e.h/2,e.w,e.h);
    if(e.y-e.h/2>H) enemies.splice(i,1);
  }

  // player bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y+=b.vy; if(b.y<-20){bullets.splice(i,1);continue;}
    ctx.fillStyle=b.color; ctx.fillRect(b.x-3,b.y-10,6,14);
  }

  // enemy bullets
  for(let i=eBullets.length-1;i>=0;i--){
    const b=eBullets[i]; b.y+=b.vy;
    if(hit(player,b)){ eBullets.splice(i,1); if(--player.lives<=0){setHearts();return endGame('GAME OVER');} setHearts(); continue; }
    if(b.y>H+20){eBullets.splice(i,1);continue;}
    ctx.fillStyle=b.color; ctx.fillRect(b.x-3,b.y-10,6,14);
  }

  // boss tetik 500+
  if(!boss.active && score>=500){
    boss.active=true; boss.x=W/2; boss.y=110; boss.w=140; boss.h=140; boss.hp=180; boss.t=0; boss.fireCD=0;
  }
  if(boss.active){
    boss.t+=dt; boss.x=W/2+Math.sin(boss.t*0.002)*(W*0.35);
    boss.fireCD-=dt;
    if(boss.fireCD<=0){
      const ly=boss.y+boss.h*0.25;
      // kƒ±sa kƒ±rmƒ±zƒ± lazerler
      eBullets.push({x:boss.x-26,y:ly,w:5,h:22,vy:3.2,color:'#ff4343'});
      eBullets.push({x:boss.x+26,y:ly,w:5,h:22,vy:3.2,color:'#ff4343'});
      boss.fireCD=420;
    }
    if(hit(boss,player)){ if(--player.lives<=0){setHearts();return endGame('GAME OVER');} setHearts(); }
    for(let i=bullets.length-1;i>=0;i--){
      const b=bullets[i]; if(hit(boss,b)){ bullets.splice(i,1); boss.hp-=2; explode(b.x,b.y,'#ff7575',10); }
    }
    if(imgBoss.complete) ctx.drawImage(imgBoss,boss.x-boss.w/2,boss.y-boss.h/2,boss.w,boss.h);
    // boss HP bar
    ctx.fillStyle='#0007'; ctx.fillRect(0,6,W,6);
    ctx.fillStyle='#0f0'; ctx.fillRect(0,6,Math.max(0,(boss.hp/180)*W),6);
    if(boss.hp<=0){
      for(let k=0;k<4;k++) setTimeout(()=>explode(boss.x+(Math.random()*80-40),boss.y+(Math.random()*60-30),'#ff7575',36),k*200);
      boss.active=false;
      setTimeout(()=>endGame('CONGRATULATIONS!'),1200);
    }
  }

  drawParts();
  requestAnimationFrame(loop);
}

/* ===== init ===== */
setHearts(); setScore(0);
requestAnimationFrame(loop);
</script>
</body>
</html>
