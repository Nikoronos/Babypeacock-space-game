<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>BPC Space â€” Level 1</title>
<style>
  html,body{margin:0;height:100%;background:#062;overflow:hidden;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #ui{position:fixed;left:0;top:0;right:0;height:36px;display:flex;align-items:center;gap:12px;padding:6px 10px;color:#fff;background:rgba(0,0,0,.15);backdrop-filter:saturate(120%) blur(3px)}
  #score{margin-left:auto;font-weight:700}
  #bossbar{position:absolute;left:60px;top:10px;height:10px;width:calc(100vw - 120px);background:#1a1a1a;border-radius:4px;overflow:hidden;display:none}
  #bossfill{height:100%;width:0;background:#19d34b}
  canvas{display:block;margin:0 auto;background:#083c2f}
  #stick{position:fixed;left:18px;bottom:18px;width:120px;height:120px;touch-action:none;opacity:.8}
  #stick>i,#stick>i:before{position:absolute;border-radius:50%}
  #stick>i{left:0;top:0;right:0;bottom:0;border:2px solid #8ff}
  #stick>i:before{content:"";left:40px;top:40px;width:40px;height:40px;background:#8ff44c99;border:2px solid #8ff}
</style>
</head>
<body>
<div id="ui">
  <span>ðŸ¦š BPC Space â€” Level 1</span>
  <div id="bossbar"><div id="bossfill"></div></div>
  <span id="score">SCORE: 0</span>
</div>
<canvas id="cv" width="420" height="740"></canvas>

<!-- Basit sanal joystick -->
<div id="stick"><i></i></div>

<!-- Firebase sayaÃ§ (varsa) -->
<script>
(function(){
  // Reponda /Js/fribase.js varsa otomatik yÃ¼kle; yoksa sessiz.
  const s=document.createElement('script');
  s.src='Js/fribase.js';  // sende dosya adÄ± 'fribase.js'
  s.onload=()=>{ if(window.BPC_incrementOnStart) try{ window.BPC_incrementOnStart(); }catch(e){} };
  s.onerror=()=>{};
  document.head.appendChild(s);
})();
</script>

<script>
const W = 420, H = 740;
const cv = document.getElementById('cv'), ctx = cv.getContext('2d');
const uiScore = document.getElementById('score');
const bossBar  = document.getElementById('bossbar');
const bossFill = document.getElementById('bossfill');

let started=true, gameOver=false;

const keys = {};
addEventListener('keydown',e=>keys[e.key]=true);
addEventListener('keyup',e=>keys[e.key]=false);

// ---- Sanal joystick ----
const stick = document.getElementById('stick');
let joy = {ax:0, ay:0};
(function(){
  let active=false, cx=0, cy=0;
  const ring = stick.querySelector('i');
  const knob = ring;
  function setKnob(dx,dy){
    const r=40, k=40;
    const len=Math.hypot(dx,dy);
    const m=len>r? r/len : 1;
    const nx=dx*m, ny=dy*m;
    knob.style.setProperty('--x',nx+'px');
    knob.style.setProperty('--y',ny+'px');
    knob.style.transform=`translate(${nx}px,${ny}px)`;
    joy.ax = nx/r; joy.ay = ny/r;
  }
  stick.addEventListener('pointerdown',e=>{
    active=true;
    const r=stick.getBoundingClientRect();
    cx=r.left+r.width/2; cy=r.top+r.height/2;
    stick.setPointerCapture(e.pointerId);
  });
  stick.addEventListener('pointermove',e=>{
    if(!active)return;
    setKnob(e.clientX-cx,e.clientY-cy);
  });
  function end(e){ active=false; joy.ax=joy.ay=0; knob.style.transform=''; }
  stick.addEventListener('pointerup', end);
  stick.addEventListener('pointercancel', end);
})();

// ---- Sprites ----
const wolfRaw = new Image();
wolfRaw.src = 'enemy_wolf.png';     // kÃ¶kte
let wolfImg = null;                 // beyazÄ± temizlenmiÅŸ sprite

wolfRaw.onload = () => {
  // Beyaza yakÄ±n pikselleri ÅŸeffafla (beyaz kutuyu kaldÄ±r)
  const off = document.createElement('canvas');
  off.width = wolfRaw.width; off.height = wolfRaw.height;
  const ictx = off.getContext('2d');
  ictx.drawImage(wolfRaw,0,0);
  const img = ictx.getImageData(0,0,off.width,off.height);
  const d = img.data;
  for(let i=0;i<d.length;i+=4){
    if(d[i]>245 && d[i+1]>245 && d[i+2]>245) d[i+3]=0;
  }
  ictx.putImageData(img,0,0);
  wolfImg = new Image();
  wolfImg.src = off.toDataURL();
};

// ---- Game state ----
const player = {x:W/2, y:H-80, r:16, vx:0, vy:0, spd:3.2, fireCD:0};
let shots=[], enemies=[], eBullets=[];
let score=0, scoreTick=0;

const WOLF_SPAWN_SCORE = 500;
let wolfActive=false;
const wolf = {x:W/2, y:-120, w:200, h:200, vx:1.6, dir:1, hp:25, entered:false, redCD:0, eyeCD:420, eyeTime:0};

// basic small enemies for early game (sarÄ± mermiler)
function spawnEnemy(){
  const x = 30 + Math.random()*(W-60);
  enemies.push({x, y:-20, vx:(Math.random()<.5? -0.7:0.7), vy:1.2, r:14, fire:60+Math.random()*60});
}
setInterval(spawnEnemy, 1200);

// ---- Controls ----
function handleInput(){
  let ax = (keys['ArrowRight']||keys['d']?1:0) - (keys['ArrowLeft']||keys['a']?1:0) + joy.ax;
  let ay = (keys['ArrowDown']||keys['s']?1:0) - (keys['ArrowUp']||keys['w']?1:0) + joy.ay;
  const len=Math.hypot(ax,ay); if(len>1){ ax/=len; ay/=len; }
  player.x += ax*player.spd; player.y += ay*player.spd;
  if(player.x<18) player.x=18; if(player.x>W-18) player.x=W-18;
  if(player.y<60) player.y=60; if(player.y>H-18) player.y=H-18;

  // fire
  if(player.fireCD>0) player.fireCD--;
  if(keys[' '] || keys['Enter'] || keys['z'] || keys['Z']){
    if(player.fireCD===0){
      shots.push({x:player.x-4,y:player.y-20,v: -6});
      shots.push({x:player.x+4,y:player.y-20,v: -6});
      player.fireCD=8;
    }
  }
}

// ---- Boss attacks ----
function spawnWolfReds(){
  // kanat uÃ§larÄ±ndan 2 kÄ±rmÄ±zÄ± top
  const left = {x:wolf.x-86, y:wolf.y+86, vx:0, vy:2.6, r:6, col:'#f33'};
  const right= {x:wolf.x+86, y:wolf.y+86, vx:0, vy:2.6, r:6, col:'#f33'};
  eBullets.push(left,right);
}
function spawnWolfBeam(){
  // 2 snâ€™lik ileri lazer (gÃ¶rsel iÃ§in parlak Ã§ubuk)
  wolf.eyeTime = 120;
}

// ---- Update ----
function update(){
  if(gameOver||!started) return;

  handleInput();

  // skor artÄ±ÅŸÄ±
  scoreTick++; if(scoreTick>=60){ score+=10; scoreTick=0; }
  uiScore.textContent = 'SCORE: '+score;

  // kÃ¼Ã§Ã¼k dÃ¼ÅŸmanlar
  enemies.forEach(e=>{
    e.x += e.vx; e.y += e.vy;
    if(e.x<20||e.x>W-20) e.vx*=-1;
    e.fire -= 1;
    if(e.fire<=0){ eBullets.push({x:e.x,y:e.y+6,vx:0,vy:3,r:4,col:'#ff0'}); e.fire=90; }
  });
  enemies = enemies.filter(e=> e.y< H+30);

  // player shots
  shots.forEach(s=> s.y += s.v);
  shots = shots.filter(s=> s.y>-10);

  // enemy bullets
  eBullets.forEach(b=>{ b.x += b.vx||0; b.y += b.vy||2.2;});
  eBullets = eBullets.filter(b=> b.y< H+20);

  // Ã§arpÄ±ÅŸmalar (kÃ¼Ã§Ã¼k dÃ¼ÅŸmanlar)
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    for(let j=shots.length-1;j>=0;j--){
      const s=shots[j];
      if(Math.hypot(e.x-s.x,e.y-s.y) < e.r+4){
        enemies.splice(i,1); shots.splice(j,1); score+=20; break;
      }
    }
  }

  // Boss spawn
  if(!wolfActive && score>=WOLF_SPAWN_SCORE){
    wolfActive=true; bossBar.style.display='block';
    wolf.y=-140; wolf.entered=false; wolf.hp=25;
  }

  // Boss davranÄ±ÅŸ
  if(wolfActive){
    if(!wolf.entered){
      wolf.y += 1.1;
      if(wolf.y>=120) wolf.entered=true;
    }else{
      wolf.x += wolf.vx*wolf.dir;
      if(wolf.x<120 || wolf.x>W-120) wolf.dir*=-1;

      if(wolf.redCD>0) wolf.redCD--; else{ spawnWolfReds(); wolf.redCD=72; }
      if(wolf.eyeCD>0) wolf.eyeCD--; else{ spawnWolfBeam(); wolf.eyeCD=480; }
    }

    // bossâ€™a isabet
    for(let j=shots.length-1;j>=0;j--){
      const s=shots[j];
      if(s.x> wolf.x-90 && s.x< wolf.x+90 && s.y> wolf.y-90 && s.y< wolf.y+90){
        shots.splice(j,1); wolf.hp--; if(wolf.hp<=0){ wolfActive=false; bossBar.style.display='none'; score+=300; }
      }
    }

    // boss lazeri (gÃ¶rsel ve temas)
    if(wolf.eyeTime>0){
      wolf.eyeTime--;
      // isabet kontrol (ortadaki kolon)
      if(Math.abs(player.x - wolf.x) < 20 && player.y < H && player.y > wolf.y){
        // oyuncuyu geriye it (Ã¶lÃ¼m yok; sade itme)
        player.y += 3;
      }
    }

    // boss HP bar
    const pct = Math.max(0,wolf.hp)/25;
    bossFill.style.width = (pct*100)+'%';
  }
}

// ---- Draw ----
function draw(){
  ctx.clearRect(0,0,W,H);

  // yÄ±ldÄ±zlÄ± basit arka plan
  ctx.fillStyle='#083c2f'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#0b5442';
  for(let i=0;i<10;i++){ ctx.fillRect((i*47+ (Date.now()/60+i)%47)%W, i*72%H, 2, 10); }

  // player
  ctx.fillStyle='#8ff'; // basit gemi (Ã¼Ã§gen)
  ctx.beginPath();
  ctx.moveTo(player.x, player.y-18);
  ctx.lineTo(player.x-12, player.y+14);
  ctx.lineTo(player.x+12, player.y+14);
  ctx.closePath(); ctx.fill();

  // shots
  ctx.fillStyle='#ffda3a';
  shots.forEach(s=>{ ctx.beginPath(); ctx.arc(s.x,s.y,4,0,Math.PI*2); ctx.fill(); });

  // enemies
  ctx.fillStyle='#e0ffe0';
  enemies.forEach(e=>{ ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,Math.PI*2); ctx.fill(); });

  // enemy bullets
  eBullets.forEach(b=>{
    ctx.fillStyle=b.col||'#ff0';
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r||3,0,Math.PI*2); ctx.fill();
  });

  // boss
  if(wolfActive && wolfImg){
    ctx.drawImage(wolfImg, wolf.x-100, wolf.y-100, 200, 200);
    // gÃ¶z lazeri
    if(wolf.eyeTime>0){
      ctx.globalAlpha = .8;
      ctx.fillStyle='#ff2a2a';
      ctx.fillRect(wolf.x-4, wolf.y+10, 8, H - (wolf.y+10));
      ctx.globalAlpha = 1;
    }
  }

  requestAnimationFrame(draw);
}

// ---- Loop ----
function tick(){ update(); setTimeout(tick, 1000/60); }
tick(); draw();
</script>
</body>
</html>
