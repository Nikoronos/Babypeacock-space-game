<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Babypeacock ‚Äî BPC Space Game v20</title>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:system-ui,Segoe UI,Roboto,Arial;overflow:hidden}
  #brand{position:fixed;top:6px;left:12px;z-index:4;font-weight:900;
    background:linear-gradient(90deg,#22d3ee,#34d399);-webkit-background-clip:text;background-clip:text;color:transparent}
  #score{position:fixed;top:8px;left:0;right:0;text-align:center;color:#00ffc8;font-weight:700;z-index:4}
  #power{position:fixed;top:8px;right:10px;color:#a7f3d0;font-weight:700;z-index:4}
  #lives{position:fixed;bottom:10px;left:0;right:0;text-align:center;color:#f87171;font-weight:700;z-index:4}
  #gameOver,#startOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;
    background:rgba(0,0,0,.84);color:#fff;font-size:20px;font-weight:800;z-index:6;text-align:center}
  .btn{margin-top:12px;padding:12px 22px;border:1px solid #00ffc8;background:#0b1220;color:#00ffc8;border-radius:12px;font-weight:900}
  canvas{display:block;margin:44px auto 0 auto;background:#020617;touch-action:none;user-select:none;width:min(420px,96vw);height:auto;max-height:92vh}
</style>
</head>
<body>
  <div id="brand">Babypeacock ü¶ö</div>
  <div id="score">ü¶ö Score: <span id="sc">0</span></div>
  <div id="power">üíé <span id="px">0</span>s</div>
  <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>

  <div id="startOverlay" style="display:flex">
    <div style="margin-bottom:8px">Hold & drag to move ‚Äî auto fire while holding</div>
    <button id="startBtn" class="btn">START</button>
    <div style="font-size:12px;opacity:.75;margin-top:8px">Tap anywhere to start</div>
  </div>

  <div id="gameOver">
    <div style="font-weight:900;margin-bottom:8px">GAME OVER</div>
    <button id="restart" class="btn">Restart</button>
    <div id="globalCounterBox" style="margin-top:10px;font-size:14px">
      üåç Global plays: <span id="globalCounter">‚Ä¶</span>
    </div>
  </div>

  <canvas id="game" width="420" height="700"></canvas>
  <audio id="boom" preload="auto" playsinline>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2b1b0dcd8c.mp3" type="audio/mpeg">
  </audio>

<script>
const cv=document.getElementById("game"),ctx=cv.getContext("2d");ctx.imageSmoothingEnabled=false;
const scEl=document.getElementById("sc"),pxEl=document.getElementById("px"),livesEl=document.getElementById("lives");
const startOverlay=document.getElementById("startOverlay"),startBtn=document.getElementById("startBtn");
const overEl=document.getElementById("gameOver"),restartBtn=document.getElementById("restart"),boom=document.getElementById("boom");

function clamp(v,a,b){return v<a?a:v>b?b:v;}
function rand(a,b){return a+Math.random()*(b-a);}
function rectHit(a,b){return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);}
function loadImage(src){return new Promise((res,rej)=>{const i=new Image();i.crossOrigin="anonymous";i.onload=()=>res(i);i.onerror=rej;i.src=src;});}

/* üîπ Arka plan temizleme (siyah/gri √ßƒ±karma) */
function keyOutDark(img,TH=110){
  const w=img.width,h=img.height,off=document.createElement('canvas');
  off.width=w;off.height=h;
  const g=off.getContext('2d');
  g.drawImage(img,0,0);
  const d=g.getImageData(0,0,w,h),a=d.data;
  for(let i=0;i<a.length;i+=4){
    const r=a[i],g1=a[i+1],b=a[i+2],lum=0.2126*r+0.7152*g1+0.0722*b;
    if((r<TH&&g1<TH&&b<TH)||lum<TH*0.9)a[i+3]=0;
  }
  g.putImageData(d,0,0);
  return off;
}

/* üîπ G√∂rseller */
const PLAYER_SRC="img/player/bpc_mini.png";
const ENEMY_SRC={
  red:"bpc_enemy_red.png",
  green:"bpc_enemy_green.png",
  ufo_red:"bpc_enemy_ufo_red.png",
  ufo_gray:"bpc_enemy_ufo_gray.png",
  merkur_white:"mars_enemy_white.png",
  merkur_green:"mars_enemy_green.png",
  merkur_yellow:"mars_enemy_yellow.png"
};
const PEACOCK_SRC="yc3ku6.jpg";

/* üîπ Oyun deƒüi≈ükenleri */
let bullets=[],enemies=[],enemyBullets=[],gems=[],mascots=[],particles=[];
let score=0,lives=3,started=false,gameOver=false;
let powerTime=0,fireTimer=0,FIRE_MS=170;
let elapsed=0,enT=0,gemT=0,mascotT=0;
const player={x:cv.width/2-33,y:cv.height-120,w:66,h:66};
function updateLives(){livesEl.innerHTML="‚ù§Ô∏è".repeat(lives);}
updateLives();

/* üîπ Ba≈ülatma */
function startGame(){if(started)return;started=true;startOverlay.style.display="none";}
startBtn.onclick=startGame;cv.onclick=startGame;
let holding=false;
function getX(e){return (e.clientX??(e.touches?e.touches[0].clientX:0))-cv.getBoundingClientRect().left;}
cv.addEventListener("pointerdown",e=>{if(!started)return;holding=true;player.x=clamp(getX(e)-player.w/2,0,cv.width-player.w);});
cv.addEventListener("pointermove",e=>{if(!holding)return;player.x=clamp(getX(e)-player.w/2,0,cv.width-player.w);});
cv.addEventListener("pointerup",()=>holding=false);

/* üîπ Mermi */
function shoot(){
  if(powerTime>0){
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10});
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:3});
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10,ang:-3});
  } else {
    bullets.push({x:player.x+player.w/2-2,y:player.y,w:4,h:12,vy:-10});
  }
}

/* üîπ D√º≈üman t√ºrleri (Merk√ºr seviyeleri) */
function allowedKinds(score,t){
  let kinds=(t<10)?["ufo_red","ufo_gray"]:(t<40)?["ufo_red","ufo_gray","green"]:["ufo_red","ufo_gray","green","red"];
  if(score>=500) kinds=kinds.filter(k=>k!=="red");
  if(score>=500) kinds.push("merkur_white");
  if(score>=600) kinds.push("merkur_green");
  if(score>=800) kinds.push("merkur_yellow");
  return kinds;
}

/* üîπ D√º≈üman √ºretimi */
function spawnEnemy(kinds){
  if(enemies.length>12)return;
  const size=rand(48,70);
  const kind=kinds[Math.floor(Math.random()*kinds.length)];
  const img=enemyImg[kind]||null;
  enemies.push({
    x:rand(0,cv.width-size),y:-size,w:size,h:size,
    vy:rand(1.4,3),kind,img,
    canShoot:(kind==="red"||kind==="green"||kind.startsWith("merkur")),
    shootT:0,shootInt:700
  });
}

/* üîπ D√º≈üman ate≈üi */
function enemyShoot(e){
  if(!e.canShoot)return;
  const cx=e.x+e.w/2;
  const bulletMul=(score>=500)?1.25:(score>=300)?1.15:1;
  enemyBullets.push({x:cx-2,y:e.y+e.h,w:3,h:14,vy:6.5*bulletMul,color:"#ef4444"});
}

/* üîπ Patlama */
function explosion(x,y,n=18){
  const left=Math.max(0,120-particles.length),count=Math.min(n,left);
  for(let i=0;i<count;i++){
    const a=Math.random()*Math.PI*2,sp=1.2+Math.random()*2.8;
    particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:420+Math.random()*280,size:1.6+Math.random()*2.4});
  }
  try{boom.currentTime=0;boom.play().catch(()=>{});}catch{}
}

/* üîπ G√ºncelleme */
function update(dt){
  if(!started||gameOver)return;
  elapsed+=dt/1000;enT+=dt;fireTimer+=dt;
  if(powerTime>0){powerTime-=dt;if(powerTime<0)powerTime=0;}
  pxEl.textContent=powerTime>0?Math.ceil(powerTime/1000):0;
  if(holding&&fireTimer>FIRE_MS){shoot();fireTimer=0;}

  if(enT>600){spawnEnemy(allowedKinds(score,elapsed));enT=0;}
  bullets.forEach(b=>{b.y+=b.vy;b.x+=(b.ang||0)*0.5;});
  bullets=bullets.filter(b=>b.y>-20);

  enemies.forEach(e=>{
    e.y+=e.vy;
    e.shootT+=dt;
    if(e.canShoot&&e.shootT>=e.shootInt){e.shootT=0;enemyShoot(e);}
  });
  enemies=enemies.filter(e=>e.y<cv.height+40);

  enemyBullets.forEach(m=>m.y+=m.vy);
  enemyBullets=enemyBullets.filter(m=>m.y<cv.height+40);

  for(const b of bullets){
    for(const e of enemies){
      if(rectHit(b,e)){
        explosion(e.x+e.w/2,e.y+e.h/2,14);
        e.dead=1;b.dead=1;score++;scEl.textContent=score;
      }
    }
  }
  for(const e of enemies){if(rectHit(player,e)){lives--;updateLives();e.dead=1;if(lives<=0)gameOver=true;}}
  for(const m of enemyBullets){if(rectHit(player,m)){lives--;updateLives();m.dead=1;if(lives<=0)gameOver=true;}}
  enemies=enemies.filter(o=>!o.dead);
  bullets=bullets.filter(o=>!o.dead);
  enemyBullets=enemyBullets.filter(o=>!o.dead);
  for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.life-=dt;if(p.life<=0)particles.splice(i,1);p.x+=p.vx;p.y+=p.vy;p.vy+=0.02;}
}

/* üîπ √áizim */
function draw(t){
  ctx.clearRect(0,0,cv.width,cv.height);
  ctx.fillStyle="rgba(255,255,255,.8)";
  for(let i=0;i<40;i++)ctx.fillRect((i*11+t/20)%cv.width,(i*29+t/40)%cv.height,1.2,1.2);

  if(playerImg)ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);

  ctx.fillStyle="#00ffc8";bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

  enemies.forEach(e=>{
    if(e.img){
      if(e.kind==="merkur_white"){
        ctx.save();ctx.translate(e.x+e.w,e.y);ctx.scale(-1,1);
        ctx.drawImage(e.img,0,0,e.w,e.h);ctx.restore();
      }else ctx.drawImage(e.img,e.x,e.y,e.w,e.h);
    }else{
      ctx.fillStyle=e.kind==="green"?"#22c55e":"#ef4444";
      ctx.fillRect(e.x,e.y,e.w,e.h);
    }
  });

  enemyBullets.forEach(m=>{ctx.fillStyle=m.color;ctx.fillRect(m.x,m.y,m.w,m.h);});
  particles.forEach(p=>{
    const a=Math.max(0,p.life/500);
    ctx.globalAlpha=a;ctx.fillStyle="rgba(255,200,80,1)";
    ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;
  });
  if(gameOver){ctx.font="bold 28px system-ui";ctx.fillStyle="#00ffc8";ctx.textAlign="center";ctx.fillText("GAME OVER",cv.width/2,cv.height/2);}
}

/* üîπ D√∂ng√º */
function loop(t){const dt=Math.min(t-(window._lt||t),32);window._lt=t;update(dt);draw(t);requestAnimationFrame(loop);}
requestAnimationFrame(loop);

/* üîπ Reset */
restartBtn.onclick=()=>{score=0;lives=3;updateLives();gameOver=false;started=false;scEl.textContent=0;startOverlay.style.display="flex";enemies=[];bullets=[];enemyBullets=[];particles=[];};

/* üîπ G√∂rselleri y√ºkle */
let playerImg=null,enemyImg={},peacockImg=null;
(async function(){
  try{const p=await loadImage(PLAYER_SRC);playerImg=keyOutDark(p,110);}catch{}
  for(const k of Object.keys(ENEMY_SRC)){
    try{const im=await loadImage(ENEMY_SRC[k]);enemyImg[k]=keyOutDark(im,110);}catch{}
  }
})();
</script>
</body>
</html>
