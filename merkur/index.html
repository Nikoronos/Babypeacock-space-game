<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>BPC Space ‚Äî Mars (Level 2)</title>
<style>
  :root{
    --bg:#050a0f;          /* gece uzay/Mars koyu g√∂ky√ºz√º */
    --hud-fg:#cdeff0;
    --hud-accent:#21e6c1;
    --heart:#ff4d6d;
    --diamond:#7fe6ff;
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
  html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Arial}
  .wrap{height:100%;display:flex;flex-direction:column}
  .hud{
    height:56px; flex:0 0 56px; display:flex; align-items:center; justify-content:space-between;
    padding:0 14px; color:var(--hud-fg); font-weight:700; letter-spacing:.5px;
    background:linear-gradient(to right, rgba(0,0,0,.65), rgba(0,0,0,.25));
    position:relative; z-index:2;
  }
  .brand{font-size:22px; color:#7fb4ff; display:flex; gap:10px; align-items:center}
  .score{font-size:22px; color:var(--hud-accent)}
  .gemhud{display:flex; align-items:center; gap:6px; font-size:18px}
  .gem{width:18px;height:18px;background:var(--diamond); clip-path:polygon(50% 0,100% 35%,80% 100%,20% 100%,0 35%);}
  .game{position:relative; flex:1 1 auto; display:flex; justify-content:center; align-items:center; overflow:hidden}
  canvas{width:100%; height:100%; display:block; touch-action:none}
  .hearts{position:absolute; left:50%; bottom:12px; transform:translateX(-50%); display:flex; gap:10px; z-index:3}
  .heart{
    width:18px;height:18px; background:var(--heart);
    transform:rotate(-45deg); position:relative;
  }
  .heart:before,.heart:after{
    content:""; position:absolute; width:18px;height:18px; background:var(--heart); border-radius:50%;
  }
  .heart:before{left:-9px; top:0}
  .heart:after{top:-9px; left:0}
  .overlay{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.6); color:#e8f6ff; text-align:center; z-index:4; padding:24px;
  }
  .panel{
    background:rgba(6,12,18,.7); border:1px solid rgba(255,255,255,.08);
    box-shadow:0 12px 40px rgba(0,0,0,.5); border-radius:14px; padding:26px 22px; max-width:520px;
  }
  .panel h1{margin:0 0 8px; font-size:28px}
  .panel p{margin:6px 0 18px; opacity:.9}
  .btn{
    display:inline-block; padding:12px 22px; border-radius:12px; font-weight:800; letter-spacing:.4px;
    color:#061016; background:var(--hud-accent); cursor:pointer; user-select:none;
  }
  /* 9:16 g√∂r√ºn√ºm i√ßin g√ºvenli alan */
  @media (min-aspect-ratio: 9/16){
    .game{padding:0 0}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div class="brand">Babypeacock ü¶ö</div>
    <div class="score">Score: <span id="score">0</span></div>
    <div class="gemhud"><div class="gem"></div><span id="gemT">0s</span></div>
  </div>
  <div class="game">
    <canvas id="cv" width="360" height="640"></canvas>
    <div class="hearts" id="hearts"></div>

    <div class="overlay" id="ovStart">
      <div class="panel">
        <h1>Mars G√∂revi</h1>
        <p><b>Basƒ±lƒ± tut & s√ºr√ºkle</b> ‚Äî basƒ±lƒ±yken <b>otomatik ate≈ü</b>.<br>
           <span style="color:var(--diamond)">Elmas</span> = <b>12s 3‚Äôl√º yayƒ±lƒ±m</b>.
        </p>
        <div class="btn" onclick="startGame()">START</div>
        <p style="opacity:.7;margin-top:12px">Tap anywhere to start</p>
      </div>
    </div>

    <div class="overlay" id="ovGameOver" style="display:none">
      <div class="panel">
        <h1>GAME OVER</h1>
        <div class="btn" onclick="restart()">TEKRAR</div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const W = () => cv.width, H = () => cv.height;

  // --- Resize to fit screen (keep logical 360x640 for physics) ---
  function fitCanvas() {
    const r = window.innerWidth / window.innerHeight;
    const base = 360/640;
    if (r > base) { // yanlarda bo≈üluk
      cv.style.height = '100%';
      cv.style.width  = (base / r * 100) + '%';
    } else {
      cv.style.width  = '100%';
      cv.style.height = (r / base * 100) + '%';
    }
  }
  window.addEventListener('resize', fitCanvas); fitCanvas();

  // --- Game state ---
  let running=false, t=0, spawnT=0, score=0;
  let bullets=[], enemies=[], stars=[], eBullets=[], diamonds=[];
  let lives=3, fireDown=false, fireCd=0, gemTimer=0;
  const HUDscore = document.getElementById('score');
  const HUDgem   = document.getElementById('gemT');
  const heartsEl = document.getElementById('hearts');

  // Player
  const player = { x: W()/2, y: H()-90, r:16, speed:6 };

  // Init stars
  function initStars(){
    stars.length=0;
    for(let i=0;i<140;i++){
      stars.push({x:Math.random()*W(), y:Math.random()*H(), s: Math.random()*1.2+0.3, v: Math.random()*0.7+0.3});
    }
  }

  function drawStars(){
    ctx.fillStyle = '#0b0f14';
    // Mars rengi ‚Äì √ßok koyu kƒ±rmƒ±zƒ±msƒ± ton
    const grd = ctx.createLinearGradient(0,0,0,H());
    grd.addColorStop(0,'#0b0f14'); grd.addColorStop(1,'#0b0f14'); // sade uzay g√∂r√ºn√ºm√º
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,W(),H());

    ctx.fillStyle = 'rgba(255,255,255,.85)';
    stars.forEach(s=>{
      s.y += s.v;
      if(s.y>H()){ s.y= -2; s.x = Math.random()*W(); }
      ctx.fillRect(s.x, s.y, s.s, s.s);
    });
  }

  function drawPlayer(){
    // BPC gemisi ‚Äì yuvarlak g√∂vde, sarƒ± mod√ºl (≈üekil; PNG kutu sorunu yok)
    const {x,y,r} = player;
    ctx.save();
    ctx.translate(x,y);
    ctx.fillStyle='#103d35';
    ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#2bd4a7'; ctx.lineWidth=2; ctx.stroke();
    ctx.fillStyle='#e3b341';
    ctx.beginPath(); ctx.arc(r*0.6,-r*0.1,5,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }

  function spawnEnemy(){
    const laneX = Math.random()* (W()-40) + 20;
    const roll = Math.random();
    // green (en sƒ±k), yellow, white (iki yandan ate≈ü), red (az)
    if (roll < .55) enemies.push(makeEnemy('green', laneX, -20));
    else if (roll < .80) enemies.push(makeEnemy('yellow', laneX, -20));
    else if (roll < .95) enemies.push(makeEnemy('white', laneX, -20));
    else enemies.push(makeEnemy('red', laneX, -20));
    // bazen elmas
    if (Math.random()<.10) diamonds.push({x:laneX, y:-20, r:8, v:2.2});
  }

  function makeEnemy(type,x,y){
    const map = {
      green:{hp:1, v:1.8, score:2, shoot:0},
      yellow:{hp:2, v:2.2, score:3, shoot:180},
      white:{hp:3, v:1.6, score:3, shoot:150, side:true},
      red:{hp:4, v:2.0, score:6, shoot:110, zig:true}
    };
    const m = map[type];
    return {type,x,y,hp:m.hp,v:m.v,score:m.score,shootCd: m.shoot, side:m.side||false, zig:m.zig||false, t:0, r:16};
  }

  function drawEnemy(e){
    ctx.save(); ctx.translate(e.x,e.y);
    // ≈üekiller: arka plan kutusu asla yok
    if (e.type==='green'){
      ctx.fillStyle='#5fbf5b';
      ctx.beginPath();
      ctx.moveTo(0,-14); ctx.lineTo(14,8); ctx.lineTo(-14,8); ctx.closePath(); ctx.fill();
      ctx.fillStyle='#0d2b1f'; ctx.fillRect(-3,-2,6,6);
    } else if (e.type==='yellow'){
      ctx.fillStyle='#f1c542';
      ctx.beginPath();
      ctx.moveTo(0,-16); ctx.lineTo(12,10); ctx.lineTo(-12,10); ctx.closePath(); ctx.fill();
      ctx.fillStyle='#44270a'; ctx.fillRect(-3,-1,6,6);
    } else if (e.type==='white'){
      // *ters √ßevrilmi≈ü* beyaz‚Äîkanatlarƒ± yanda
      ctx.fillStyle='#c9d4e4';
      ctx.fillRect(-14,-6,28,12);
      ctx.fillStyle='#5a6b7a';
      ctx.fillRect(-4,-4,8,8);
      // yan kanatlar
      ctx.fillRect(-20,-3,6,6); ctx.fillRect(14,-3,6,6);
    } else { // red
      ctx.fillStyle='#e25555';
      ctx.beginPath(); ctx.arc(0,0,14,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#5b0b0b'; ctx.beginPath(); ctx.arc(0,0,6,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();
  }

  function drawDiamond(d){
    ctx.save(); ctx.translate(d.x,d.y);
    ctx.fillStyle='#7fe6ff';
    ctx.beginPath();
    ctx.moveTo(0,-10); ctx.lineTo(12,0); ctx.lineTo(0,10); ctx.lineTo(-12,0); ctx.closePath(); ctx.fill();
    ctx.restore();
  }

  function fire(){
    const sp = -6.4;
    if (gemTimer>0){
      bullets.push({x:player.x, y:player.y-18, vx:0, vy:sp});
      bullets.push({x:player.x-8, y:player.y-18, vx:-1.2, vy:sp});
      bullets.push({x:player.x+8, y:player.y-18, vx:1.2, vy:sp});
    } else {
      bullets.push({x:player.x, y:player.y-18, vx:0, vy:sp});
    }
  }

  function enemyShoot(e){
    if (!e.shootCd) return;
    if (--e.shootCd<=0){
      e.shootCd = (e.type==='red')? 90 : (e.type==='yellow'? 160: 150);
      if (e.side){
        eBullets.push({x:e.x-12,y:e.y, vx:-1.6, vy:2.6});
        eBullets.push({x:e.x+12,y:e.y, vx: 1.6, vy:2.6});
      } else {
        const vx = (player.x - e.x)*0.015;
        eBullets.push({x:e.x,y:e.y, vx:vx, vy:2.4});
      }
    }
  }

  function update(dt){
    t += dt; fireCd -= dt;
    if (gemTimer>0){ gemTimer-=dt; HUDgem.textContent = Math.max(0,Math.ceil(gemTimer/60))+'s'; }
    else HUDgem.textContent = '0s';

    // spawn hƒ±zƒ±nƒ± yava≈ü yava≈ü artƒ±r
    spawnT -= dt;
    if (spawnT<=0){
      spawnEnemy();
      spawnT = Math.max(35, 80 - Math.floor(score/20));
    }

    // Player hareketi (pointer takip)
    // ate≈ü
    if (fireDown && fireCd<=0){
      fire(); fireCd = 12; // ~200ms
    }

    // Bullets
    bullets = bullets.filter(b=>{
      b.x += b.vx; b.y += b.vy;
      return b.y>-20 && b.x>-20 && b.x<W()+20;
    });

    // Enemies
    enemies = enemies.filter(e=>{
      e.t += dt;
      if (e.zig) e.x += Math.sin(e.t/25)*0.9;
      e.y += e.v;
      enemyShoot(e);
      return e.y < H()+30 && e.hp>0;
    });

    // Enemy bullets
    eBullets = eBullets.filter(b=>{
      b.x += b.vx; b.y += b.vy;
      return b.y<H()+25 && b.x>-25 && b.x<W()+25;
    });

    // Diamonds
    diamonds = diamonds.filter(d=>{
      d.y += d.v; return d.y < H()+20;
    });

    // √áarpmalar: mermi -> d√º≈üman
    bullets.forEach(b=>{
      enemies.forEach(e=>{
        if (hit(b.x,b.y, e.x,e.y, e.r)){
          e.hp--; b.y=-9999;
          if (e.hp<=0){ score+=e.score; HUDscore.textContent=score; }
        }
      });
    });

    // √áarpmalar: d√º≈üman -> player
    enemies.forEach(e=>{
      if (circHit(player,e)) damage();
    });
    eBullets.forEach(b=>{
      if (hit(b.x,b.y, player.x,player.y, player.r)) { b.y=H()+999; damage(); }
    });

    // Elmas -> player
    diamonds.forEach(d=>{
      if (hit(d.x,d.y, player.x,player.y, player.r)){
        gemTimer = 60*12; d.y = H()+999;
      }
    });
  }

  function hit(x1,y1,x2,y2,r){ const dx=x1-x2, dy=y1-y2; return dx*dx+dy*dy <= r*r; }
  function circHit(a,b){ return hit(a.x,a.y,b.x,b.y, a.r+b.r-4); }

  function damage(){
    if (!running) return;
    lives--; updateHearts();
    if (lives<=0){ gameOver(); }
    else{
      // k√º√ß√ºk invuln / geri it
      player.y = Math.min(H()-90, player.y+26);
    }
  }

  function render(){
    drawStars();

    // elmas
    diamonds.forEach(drawDiamond);

    // mermi (oyuncu)
    ctx.strokeStyle = '#6fd9ff';
    ctx.lineWidth = 4;
    bullets.forEach(b=>{
      ctx.beginPath(); ctx.moveTo(b.x,b.y); ctx.lineTo(b.x-b.vx*1.5, b.y-b.vy*1.5); ctx.stroke();
    });

    // d√º≈ümanlar
    enemies.forEach(drawEnemy);

    // d√º≈üman mermileri
    ctx.strokeStyle = '#ff5555';
    ctx.lineWidth = 3;
    eBullets.forEach(b=>{
      ctx.beginPath(); ctx.moveTo(b.x,b.y); ctx.lineTo(b.x-b.vx*2, b.y-b.vy*2); ctx.stroke();
    });

    // player
    drawPlayer();
  }

  // --- Game loop ---
  let raf;
  function loop(){
    if (!running) return;
    update(1); // sabit timestep (1 ‚âà 1 frame @60fps)
    render();
    raf = requestAnimationFrame(loop);
  }

  // --- Hearts UI ---
  function updateHearts(){
    heartsEl.innerHTML='';
    for(let i=0;i<lives;i++){
      const h=document.createElement('div'); h.className='heart'; heartsEl.appendChild(h);
    }
  }

  // --- Controls (drag to move & hold-to-fire) ---
  function posFromEv(ev){
    const rect = cv.getBoundingClientRect();
    const x = (ev.clientX - rect.left) / rect.width  * W();
    const y = (ev.clientY - rect.top)  / rect.height * H();
    return {x,y};
  }
  function onDown(ev){ fireDown=true; const p=posFromEv(ev); player.x=p.x; player.y=Math.max(80,Math.min(H()-40,p.y)); ev.preventDefault();}
  function onMove(ev){ if(!fireDown) return; const p=posFromEv(ev); player.x=Math.max(20,Math.min(W()-20,p.x)); player.y=Math.max(80,Math.min(H()-40,p.y)); ev.preventDefault();}
  function onUp(){ fireDown=false; }

  cv.addEventListener('pointerdown', onDown, {passive:false});
  window.addEventListener('pointermove', onMove, {passive:false});
  window.addEventListener('pointerup', onUp);
  window.addEventListener('pointercancel', onUp);

  // --- Overlay controls ---
  window.startGame = function(){
    document.getElementById('ovStart').style.display='none';
    reset(); running=true; loop();
  }
  window.restart = function(){
    document.getElementById('ovGameOver').style.display='none';
    document.getElementById('ovStart').style.display='flex';
  }

  function reset(){
    bullets.length = enemies.length = eBullets.length = diamonds.length = 0;
    score=0; HUDscore.textContent='0'; gemTimer=0; HUDgem.textContent='0s';
    lives=3; updateHearts();
    player.x=W()/2; player.y=H()-90;
    initStars(); t=0; spawnT=10; fireCd=0;
  }

  function gameOver(){
    running=false; cancelAnimationFrame(raf);
    document.getElementById('ovGameOver').style.display='flex';
  }

  // ƒ∞lk g√∂r√ºn√ºm
  reset();
})();
</script>
</body>
</html>
